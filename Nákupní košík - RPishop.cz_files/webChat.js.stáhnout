(()=>{"use strict";var t={59688:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Avatar=void 0;var r=n(47767),o=function(){function t(t){this.defaultBotImageData="data:image/svg+xml,%3Csvg fill='silver' xmlns='http://www.w3.org/2000/svg' aria-hidden='true' preserveAspectRatio='xMidYMid meet' viewBox='0 0 640 512'%3E%3Cpath d='M32 224h32v192H32a31.962 31.962 0 0 1-32-32V256a31.962 31.962 0 0 1 32-32zm512-48v272a64.063 64.063 0 0 1-64 64H160a64.063 64.063 0 0 1-64-64V176a79.974 79.974 0 0 1 80-80h112V32a32 32 0 0 1 64 0v64h112a79.974 79.974 0 0 1 80 80zm-280 80a40 40 0 1 0-40 40a39.997 39.997 0 0 0 40-40zm-8 128h-64v32h64zm96 0h-64v32h64zm104-128a40 40 0 1 0-40 40a39.997 39.997 0 0 0 40-40zm-8 128h-64v32h64zm192-128v128a31.962 31.962 0 0 1-32 32h-32V224h32a31.962 31.962 0 0 1 32 32z' /%3E%3C/svg%3E",this.defaultBotName="Chatbot",this.defaultAvatar="https://secure.gravatar.com/avatar?s=64&d=mm&r=g",this._chatBoxGetter=t}return t.prototype.isShowSettingsAvatarImage=function(t){var e=this._chatBoxGetter.chatBoxSettings;return t.type===r.Message.TYPE_FROM_OPERATOR?t.operatorId?e.behaviour.isShowAvatarImage:e.behaviour.isShowAvatarInOffline:t.type===r.Message.TYPE_CHATBOT||t.type===r.Message.TYPE_CHATBOT_REACTION||!!this.isTypeAutoMessage(t.type)&&e.behaviour.isShowAvatarInTrigger},t.prototype.isShowSettingsAvatarName=function(t){var e=this._chatBoxGetter.chatBoxSettings;return t.type===r.Message.TYPE_FROM_OPERATOR?t.operatorId?e.behaviour.isShowAvatarName:e.behaviour.isShowAvatarInOffline:t.type===r.Message.TYPE_CHATBOT||t.type===r.Message.TYPE_CHATBOT_REACTION||!!this.isTypeAutoMessage(t.type)&&e.behaviour.isShowAvatarInTrigger},t.prototype.getAvatarNameByMessage=function(t,e){var n=this._chatBoxGetter.chatBoxSettings;return this.isShowSettingsAvatarName(t)?n.behaviour.avatarName?n.behaviour.avatarName:this.defaultBotName:e.name},t.prototype.getDefaultAvatarImage=function(t){return this.isTypeAutoMessage(t.type)?this.defaultBotImageData:this.defaultAvatar},t.prototype.getAvatarImageByMessage=function(t,e){var n=this._chatBoxGetter.chatBoxSettings;return this.isShowSettingsAvatarImage(t)?n.behaviour.avatarImage?n.behaviour.avatarImage:this.getDefaultAvatarImage(t):e.img},t.prototype.buildAvatarImageByMessage=function(t,e){return'<img src="'+this.getAvatarImageByMessage(t,e)+'" title="'+this.getAvatarNameByMessage(t,e)+'" />'},t.prototype.getAvatarImageSimple=function(t){var e=this._chatBoxGetter.chatBoxSettings;return e.behaviour.isShowAvatarImage||null===t?e.behaviour.avatarImage?e.behaviour.avatarImage:this.defaultAvatar:t.img},t.prototype.getAvatarNameSimple=function(t){var e=this._chatBoxGetter.chatBoxSettings;return e.behaviour.isShowAvatarName||null===t?e.behaviour.avatarName?e.behaviour.avatarName:this.defaultBotName:t.name},t.prototype.buildAvatarSimple=function(t){return'<img src="'+this.getAvatarImageSimple(t)+'" title="'+this.getAvatarNameSimple(t)+'" />'},t.prototype.getBotAvatarName=function(){var t=this._chatBoxGetter.chatBoxSettings;return t.behaviour.avatarName?t.behaviour.avatarName:this.defaultBotName},t.prototype.getBotAvatarImage=function(){var t=this._chatBoxGetter.chatBoxSettings;return t.behaviour.avatarImage?t.behaviour.avatarImage:this.defaultBotImageData},t.prototype.buildBotAvatarImage=function(){return'<img src="'+this.getBotAvatarImage()+'" title="'+this.getBotAvatarName()+'" />'},t.prototype.isTypeAutoMessage=function(t){return t===r.Message.TYPE_TRIGGER||t===r.Message.TYPE_CHATBOT},t}();e.Avatar=o},25402:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BlockForRendererBag=void 0;var n=function(){function t(t,e,n,r,o,i){this._chatWindow=t,this._chatWelcome=e,this._chatOffline=n,this._chatDirectMessage=r,this._closedChat=o,this._openedChat=i}return Object.defineProperty(t.prototype,"chatWindow",{get:function(){return this._chatWindow},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatWelcome",{get:function(){return this._chatWelcome},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatOffline",{get:function(){return this._chatOffline},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatDirectMessage",{get:function(){return this._chatDirectMessage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"closedChat",{get:function(){return this._closedChat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"openedChat",{get:function(){return this._openedChat},enumerable:!1,configurable:!0}),t}();e.BlockForRendererBag=n},36109:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBox=void 0;var n=function(){function t(t,e,n,r,o,i){this.status_open="open",this.status_closed="closed",this.status_welcome="welcome",this._keyStorageInitTicketData="supportboxChat_initTicketData",this._id=t,this._secret=e,this._config=n,this._runAsHidden=r,this._endPoint=n.endPoint,this._applicationPoint=n.applicationPoint,this._countUnreadMessages=0,this._countMessages=0,this._countTriggerInChat=0,this._currentStatus=o,this._wasInitMessageHidden=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"secret",{get:function(){return this._secret},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endPoint",{get:function(){return this._endPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"applicationPoint",{get:function(){return this._applicationPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOpenWindow",{get:function(){return this._currentStatus!==this.status_closed&&0!==this._countMessages},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"countUnreadMessages",{get:function(){return this._countUnreadMessages},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._currentStatus},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isStatusClosed",{get:function(){return this._currentStatus===this.status_closed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isStatusWelcome",{get:function(){return this._currentStatus===this.status_welcome},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isStatusOpen",{get:function(){return this._currentStatus===this.status_open},enumerable:!1,configurable:!0}),t.prototype.isReadyViewMessage=function(t){return this.isStatusOpen||this.isStatusWelcome&&this.hasMessages()&&!t.behaviour.askUserInfoOnlineBeforeMessage||this.isStatusWelcome&&t.behaviour.askUserInfoOnlineAfterMessage||this.isReadyViewMessageButton(t)},t.prototype.isReadyViewMessageButton=function(t){return(this.isStatusOpen||this.isStatusWelcome)&&(null==t?void 0:t.chatBotButtonBased.isChatBotButtonBasedActive())},t.prototype.isReadyInitMessageButton=function(t){return(this.isStatusOpen||this.isStatusWelcome)&&!(null==t?void 0:t.chatBotButtonBased.isInitDisplayButtonsCalled())},t.prototype.markAsOpen=function(){this._currentStatus=this.status_open},t.prototype.markAsClose=function(){this._currentStatus=this.status_closed},t.prototype.markAsWelcome=function(){this._currentStatus=this.status_welcome},t.prototype.openSomeWindowAndSetStatus=function(t,e,n,r){this.wasInitTicketData()&&!(null==e?void 0:e.behaviour.askUserInfoOnline)&&(null==e?void 0:e.chatBotButtonBased.isChatBotButtonBasedActive())?this._currentStatus=this.status_open:!t||n&&r?!(null==e?void 0:e.behaviour.askUserInfoOnline)&&this._countTriggerInChat?this._currentStatus=this.status_open:0===this._countMessages||(null==e?void 0:e.behaviour.askUserInfoOnline)&&!n?this._currentStatus=this.status_welcome:this._currentStatus=this.status_open:this._currentStatus=this.status_welcome,this.isReadyViewMessage(e)&&(this._countUnreadMessages=0)},t.prototype.addMissingMessage=function(){this._countUnreadMessages++},t.prototype.addMessageNumber=function(){this._countMessages++},t.prototype.addTriggerInChat=function(){this._countTriggerInChat++},t.prototype.hasMessages=function(){return this._countMessages>0},t.prototype.markInitMessageAsHidden=function(){this._wasInitMessageHidden=!0},Object.defineProperty(t.prototype,"wasInitMessageHidden",{get:function(){return this._wasInitMessageHidden},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"runAsHidden",{get:function(){return this._runAsHidden},enumerable:!1,configurable:!0}),t.prototype.isRunAsHidden=function(){return!0===this.runAsHidden},Object.defineProperty(t.prototype,"keyStorageInitTicketData",{get:function(){return this._keyStorageInitTicketData+"["+this._id+"]"},enumerable:!1,configurable:!0}),t.prototype.markInitTicketData=function(t){void 0===t&&(t="true"),window.localStorage.setItem(this.keyStorageInitTicketData,t)},t.prototype.wasInitTicketData=function(){return"true"===window.localStorage.getItem(this.keyStorageInitTicketData)},t.initialStatus="closed",t}();e.ChatBox=n},76284:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxApiBridge=void 0;var r=n(35500),o=function(){function t(t,e,n){this.chatBoxGetter=t,this.chatBoxRenderer=e,this.statusDetector=n}return t.prototype.init=function(){var t=this;t.chatBoxRenderer.changeHiddenChat(t.chatBoxGetter.chatBox.isRunAsHidden()),window.supportBoxApi=t,r.ChatBoxEventOutput("supportBox:api:initialized")},t.prototype.isRunAsHidden=function(){return this.chatBoxGetter.chatBox.isRunAsHidden()},t.prototype.getIframe=function(){return this.chatBoxRenderer.getIframe()},t.prototype.isShow=function(){return!this.chatBoxRenderer.isHiddenChat()},t.prototype.show=function(){this.chatBoxRenderer.changeHiddenChat(!1)},t.prototype.hide=function(){this.chatBoxRenderer.changeHiddenChat(!0)},t.prototype.isOnline=function(){return!this.statusDetector.isStatusOffline()},t.prototype.open=function(){this.chatBoxGetter.chatBox.isStatusClosed&&this.chatBoxRenderer.toggleChatbox(this.chatBoxGetter.chatBox,this.chatBoxGetter.chatBoxSettings)},t.prototype.close=function(){this.chatBoxGetter.chatBox.isStatusClosed||this.chatBoxRenderer.toggleChatbox(this.chatBoxGetter.chatBox,this.chatBoxGetter.chatBoxSettings)},t.prototype.statusIndicatorHide=function(){this.chatBoxRenderer.changeStatusIndicator(!1)},t.prototype.statusIndicatorShow=function(){this.chatBoxRenderer.changeStatusIndicator(!0)},t}();e.ChatBoxApiBridge=o},59860:(t,e)=>{var n;Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxAskUserInfoEnum=void 0,(n=e.ChatBoxAskUserInfoEnum||(e.ChatBoxAskUserInfoEnum={}))[n.NO=0]="NO",n[n.YES_BEFORE_MESSAGE=1]="YES_BEFORE_MESSAGE",n[n.YES_AFTER_MESSAGE=2]="YES_AFTER_MESSAGE"},12755:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxAttachment=void 0;var i=n(51491),s=n(71613),a=function(){function t(){this.attachments=[],this.fileMaxSize=10485760,this.fileUploadURL="/chat/attachment/upload/chat-client/",this.buttonAttachment="#supportBoxWebChatAttachment",this.selectorAttachments="#supportBoxWebChatAttachments",this.chatBoxStatePersister=new s.ChatBoxStatePersister,this.iconAttachment='<svg class="sb-attachment--mini" width="11px" height="14px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" preserveAspectRatio="xMidYMid meet" viewBox="0 0 1408 1536"><path d="M1404 1257q0 117-79 196t-196 79q-135 0-235-100L117 656Q4 541 4 385q0-159 110-270T383 4q158 0 273 113l605 606q10 10 10 22q0 16-30.5 46.5T1194 822q-13 0-23-10L565 205q-79-77-181-77q-106 0-179 75t-73 181q0 105 76 181l776 777q63 63 145 63q64 0 106-42t42-106q0-82-63-145L633 531q-26-24-60-24q-29 0-48 19t-19 48q0 32 25 59l410 410q10 10 10 22q0 16-31 47t-47 31q-12 0-22-10L441 723q-63-61-63-149q0-82 57-139t139-57q88 0 149 63l581 581q100 98 100 235z" fill="currentColor"></path></svg>'}return t.prototype.attached=function(t,e,n,i){return r(this,void 0,void 0,(function(){var r,s=this;return o(this,(function(o){switch(o.label){case 0:return i.behaviour.isDisableAttachments?[2]:[4,this.selectFile()];case 1:return 0===(r=o.sent()).length||r.forEach((function(r){if(r.size>s.fileMaxSize)s.showErrorMessage("File is too large.");else{var o=s,a=new FormData;a.append("file",r),s.uploadingInfo(t),fetch(i.entryPoint+o.fileUploadURL+e+"/"+n,{method:"POST",body:a}).then((function(t){if(!t.ok)throw new Error("Bad status code from server.");return t.json()})).then((function(e){o.saveAttachment(e),o.viewAttachments(t,n)}))}})),[2]}}))}))},t.prototype.uploadingInfo=function(t){var e='\n            <div class="sb-attachment sb-color__primary-bg">\n                <a class="sb-preview">\n                    '+this.iconAttachment+'\n                    <span class="sb-name">Nahrávám...</span>\n                </a>\n            </div>\n        ';this.setHtmlAttachments(t,e)},t.prototype.saveAttachment=function(t){t&&(this.attachments.push(new i.MessageAttachment(t.link,t.name,t.size,t.deleteUrl)),this.saveToLocalStorage())},t.prototype.saveToLocalStorage=function(){this.chatBoxStatePersister.saveAttachments(this.getAttachments())},t.prototype.showErrorMessage=function(t){alert(t)},t.prototype.getAttachments=function(){return this.attachments},t.prototype.setAttachments=function(t){this.attachments=t,this.saveToLocalStorage()},t.prototype.resetAttachments=function(t){this.attachments=[],this.saveToLocalStorage(),this.setHtmlAttachments(t,""),this.setButtonAttachmentStyle(t,"display:block")},t.prototype.selectFile=function(){return new Promise((function(t){var e=document.createElement("input");e.type="file",e.accept="*",e.multiple=!1,e.onchange=function(n){var r=Array.from(e.files);t(r)},e.click()}))},t.prototype.setButtonAttachmentStyle=function(t,e){t.querySelector(this.buttonAttachment).setAttribute("style",e)},t.prototype.setHtmlAttachments=function(t,e){t.querySelector(this.selectorAttachments).innerHTML=e},t.prototype.initButtonDelete=function(t){var e=this,n=t.querySelector(this.selectorAttachments+" .sb-delete");null!==n&&n.addEventListener("click",(function(n){n.preventDefault(),fetch(n.target.getAttribute("data-href")).then((function(t){return t.json()})).then((function(){e.resetAttachments(t),e.saveToLocalStorage()}))}))},t.prototype.viewAttachments=function(t,e){1===this.attachments.length&&this.setButtonAttachmentStyle(t,"display:none");var n="",r=this.iconAttachment;this.attachments.forEach((function(t){n+='\n                <div class="sb-attachment sb-color__primary-bg" title="'+t.size+'">\n                    <a class="sb-preview" title="Náhled: '+t.name+'" href="'+t.link+'" target="_blank" data-modal-attachment="'+t.name+'">\n                        '+r+'\n                        <span class="sb-name">'+t.name+'</span>\n                    </a><a class="sb-delete" title="Smazat: '+t.name+'" data-href="'+t.deleteUrl+'">×</a>\n                </div>\n            '})),this.setHtmlAttachments(t,n),this.initButtonDelete(t)},t}();e.ChatBoxAttachment=a},78120:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxClientSound=void 0;var r=n(71613),o=function(){function t(){this.soundFile="/assets/app-frontend/sound/chat-new-message.mp3",this._chatBoxStatePersister=new r.ChatBoxStatePersister}return t.prototype.init=function(t,e){this._chatBox=t,this._settings=e},t.prototype.getClientSoundStorageName=function(){return this._chatBoxStatePersister.keyClientSound+"["+this._chatBox.id+"]"},t.prototype.getClientSound=function(){var t=this._settings.behaviour.defaultClientSound,e=window.localStorage.getItem(this.getClientSoundStorageName());return e&&(t="true"==e),t},t.prototype.setClientSound=function(t){this._chatBoxStatePersister.saveValue(this.getClientSoundStorageName(),t),this.play()},t.prototype.play=function(){if(this.getClientSound()){var t=document.createElement("audio");t.src=this._chatBox.applicationPoint+this.soundFile;var e=t.play();e&&e.catch((function(t){})).then((function(){}))}},t}();e.ChatBoxClientSound=o},35500:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxEventOutput=void 0,e.ChatBoxEventOutput=function(t,e){void 0===e&&(e={}),window.dispatchEvent(new CustomEvent(t,{detail:e}))}},749:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxGetter=void 0;var n=function(){function t(){this._chatBox=null,this._chatBoxSettings=null,this._operators=[]}return t.prototype.refreshOperators=function(t){this._operators=t},t.prototype.setState=function(t,e,n){this._chatBox=t,this._chatBoxSettings=e,this._operators=n},Object.defineProperty(t.prototype,"chatBox",{get:function(){if(null===this._chatBox)throw new Error("ChatBox is not set");return this._chatBox},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatBoxSettings",{get:function(){if(null===this._chatBoxSettings)throw new Error("ChatBox settings is not set");return this._chatBoxSettings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"operators",{get:function(){return this._operators},enumerable:!1,configurable:!0}),t}();e.ChatBoxGetter=n},82149:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxMenu=void 0;var r=n(78120),o=function(){function t(){this.hamburger='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#fff" width="20px" height="20px" viewBox="0 0 32 32" xml:space="preserve"><path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/></svg>',this.arrowDown='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#fff" width="25px" height="18px" viewBox="0 0 960 560" xml:space="preserve"><path d="M480,344.181L268.869,131.889c-15.756-15.859-41.3-15.859-57.054,0c-15.754,15.857-15.754,41.57,0,57.431l237.632,238.937   c8.395,8.451,19.562,12.254,30.553,11.698c10.993,0.556,22.159-3.247,30.555-11.698l237.631-238.937   c15.756-15.86,15.756-41.571,0-57.431s-41.299-15.859-57.051,0L480,344.181z"/></svg>',this.close="&#10005;"}return t.prototype.createHtmlMenu=function(t){void 0===t&&(t=!0);var e=t?'<div class="menu-spacer"> </div>':"",n=t?"hidden":"",r=t?"":"hidden";return'\n            <div class="menu">\n                <span class="menu-btn menu-content">\n                    '+this.hamburger+'\n                </span>\n                <span class="menu-btn menu-minimize '+n+'">\n                    '+this.arrowDown+'\n                </span>\n                <span class="menu-btn close '+r+'">\n                    '+this.close+"\n                </span>\n            </div>\n            "+e+"\n        "},t.prototype.init=function(t,e,n,o){this._iFrame=t,this._chatBox=e,this._settings=n,this._translator=o,this._clientSound=new r.ChatBoxClientSound,this._clientSound.init(e,n);var i=t.querySelector("#supportBoxWebChat");i&&(this.buildHtmlMenu(i),this.eventHideMenu(),this.eventShowMenu(),this.eventSwitch())},t.prototype.eventShowMenu=function(){var t=this;this._iFrame.querySelectorAll(".menu-content").forEach((function(e){e.addEventListener("click",(function(e){e.preventDefault(),t._iFrame.getElementById("menuBox").focus()}))}))},t.prototype.eventSwitch=function(){var t=this,e=function(e){e.preventDefault();var n=e.target;n.id||(n=e.target.parentElement);var r=!("true"==n.getAttribute("aria-checked"));n.setAttribute("aria-checked",String(r)),t.switchAction(n.id,r)};this._iFrame.querySelectorAll(".switch").forEach((function(t){t.addEventListener("click",e,!1)}))},t.prototype.switchAction=function(t,e){"switchSound"===t&&this._clientSound.setClientSound(e)},t.prototype.eventHideMenu=function(){var t=this;this._iFrame.querySelector(".menu-btn-overlay").addEventListener("click",(function(e){e.preventDefault();var n=t._iFrame.getElementById("menuBox");n.focus(),n.blur()}))},t.prototype.buildHtmlMenu=function(t){var e=document.createElement("div");e.setAttribute("tabindex","-1"),e.classList.add("menu-btn-overlay");var n=document.createElement("div");n.id="menuBox",n.tabIndex=0,n.classList.add("menu-box"),n.appendChild(e),n.innerHTML+=this.htmlMenuItems(),t.appendChild(n)},t.prototype.htmlMenuItems=function(){var t,e="";return e+='<div class="menu-item menu-item_sound">\n                    '+this._translator.translate("webchatSettingsSound")+"\n                    "+this.buildSwitch("switchSound")+"\n                </div>",!0===(null===(t=this._settings)||void 0===t?void 0:t.allowChatTranscription)&&(e+='<div class="menu-item menu-item_email hidden">\n                <input type="email" name="email" \n                    placeholder="'+this._translator.translate("webchatSettingsToEmail")+'" \n                    class="form-control"\n                />\n                <button type="button"></button>\n            </div>'),e},t.prototype.showEmailTranscriptionInMenu=function(){if(this._iFrame){var t=this._iFrame.querySelector("#menuBox .menu-item_email.hidden");t&&t.classList.remove("hidden")}},t.prototype.buildSwitch=function(t){var e=document.createElement("span");return e.id=t,e.tabIndex=0,e.setAttribute("role","checkbox"),e.setAttribute("aria-checked",String(this._clientSound.getClientSound())),e.setAttribute("aria-disabled","false"),e.classList.add("switch","switch-small"),e.appendChild(document.createElement("small")),e.outerHTML},t}();e.ChatBoxMenu=o},78552:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxRenderer=void 0;var a=n(25402),u=n(34181),l=n(47767),c=n(35500),h=n(83133),p=n(30428),d=function(){function t(t,e,n,r,o,i,s,a,u,l,c,h,p,d,f,g,m,y,b,v,_,B){this.classPrimaryDocument="sb_mobile",this.chatBotMessageDelayInSeconds=0,this.timeoutForSendingCustomerIsWriting=null,this.canSetTimeoutForSendingCustomerIsWriting=!0,this.realMessageSend=!1,this._stackId=0,this._hasMessageFromCustomer=!1,this.isOnceFocusedInput=!1,this.isOnceFocusedTextArea=!1,this._runMessageScrolling=null,this._runMessageScrollingTimeout=!1,this._currentAnimationScrollToElement=null,this.DELAY_FOR_CORRECT_ORDER_MESSAGES=1e3,this._html=t,this._cookie=e,this._dateTime=n,this._deviceDetector=r,this._user=o,this._messageOutgoingQueue=i,this._variableSender=s,this._lastVisitUrlSender=a,this._emailValidator=u,this._chatBoxStatePersister=l,this._translator=c,this._messageRepository=h,this._statusDetector=p,this._operatorsFetcher=d,this._chatBoxGetter=f,this._chatState=g,this._iframeSizeCalculator=m,this._chatBoxAttachment=y,this._chatBoxMenu=b,this._chatBoxClientSound=v,this._avatar=_,this._chatBoxApiBridge=B,this._conn=null}return t.prototype.init=function(t,e){this.renderHtmlStructures(t,t.applicationPoint,e),this.resetChatVariables(),this.supportBoxLoadMessages(t,e),this.initHandles(t,e),this.addStylesToPrimaryDocument(),this.initPingRequestSender(),this.initAttachment(t),this.initMenuTranscriptionSend(),this.initWatchSendFirstMessageInAnyBrowserTab();var n=this._messageRepository.findLast();null!==n&&this.renderOperatorInHeader(n,e)},t.prototype.initWatchSendFirstMessageInAnyBrowserTab=function(){if(!this.isRealMessageSend()&&!this._chatBoxStatePersister.hasLastMessageClientTimestamp()){var t=this,e=function(){t._chatBoxStatePersister.hasLastMessageClientTimestamp()&&(t.fakeButtonSelectedInDOM(),clearInterval(n))},n=setInterval((function(){return e()}),5e3);e(),window.addEventListener("supportBox:message:send",(function(){clearInterval(n),t._chatBoxStatePersister.saveLastMessageClientTimestamp()}))}},t.prototype.tryInitChatBotButtonBased=function(){var t=this._chatBoxGetter.chatBoxSettings;(null==t?void 0:t.chatBotButtonBased.isChatBotButtonBasedActive())||this.initChatBotButtonBased()},t.prototype.getMessageButtonBasedWithoutSelected=function(){return this.getIframeDocument().querySelector('#supportBoxWebChatMessages .chat-message-buttons[data-button-selected=""]')},t.prototype.hasMessageButtonBasedWithoutSelected=function(){return!!this.getMessageButtonBasedWithoutSelected()},t.prototype.hasMessageButtonBasedSelected=function(){return!!this.getIframeDocument().querySelector('#supportBoxWebChatMessages .chat-message-buttons[data-button-selected]:not([data-button-selected=""])')},t.prototype.initChatBotButtonBased=function(){var t=this._chatBoxGetter.chatBoxSettings;(null==t?void 0:t.chatBotButtonBased)&&(t.chatBotButtonBased.trySetDisplayButtons(),this.refreshChatBotButtonBased(t))},t.prototype.isChatbotActiveInChat=function(t){return 0===Number(t.operatorId)&&t.isTypeAnyChatbot()&&!function(t){return t.type===l.Message.TYPE_CHATBOT_REACTION&&null!==t.chatBotAnswer&&!t.isChatBotAnswerPositive()}(t)},t.prototype.refreshChatBotButtonBased=function(t){t.chatBotButtonBased.isChatBotButtonBasedActive()&&(this.removeChatBotButtonBasedInitMessages(),this.renderChatBotButtonBased(t))},t.prototype.renderChatBotButtonBased=function(t){if(t.chatBotButtonBased.isChatBotButtonBasedActive()){if(!this._chatState.isResolved||this.hasMessageButtonBasedWithoutSelected())return;this.hasMessageButtonBasedSelected()?t.chatBotButtonBased.isSwitchedToOperator()||this.renderChatMessageButton(this.createMessageAgainRunChatBotButtonBased()):(this.addMessageByChatBotButtonContents(),this.renderChatMessageButton(this.createMessageByChatBotButtonBased()))}},t.prototype.getChatBotButtonBasedTextRunAgain=function(){var t=this._chatBoxGetter.chatBoxSettings.chatBotButtonBased.getDisplayButtons();return(null==t?void 0:t.textRunAgain)?t.textRunAgain:this._translator.translate("buttonBasedChatbotRunAgain")},t.prototype.createMessageAgainRunChatBotButtonBased=function(){return new l.Message(0,null,"message-button",null,null,null,null,null,null,null,null,null,null,JSON.stringify([{id:"resetChatBot",title:this.getChatBotButtonBasedTextRunAgain(),type:"reset",url:null}]),null,null,null,null)},t.prototype.addMessageByChatBotButtonContents=function(){var t=this,e=this._chatBoxGetter.chatBoxSettings,n=e.chatBotButtonBased.getDisplayButtons();(null==n?void 0:n.contents.hasContents)&&n.contents.contents.forEach((function(n){t.renderReactionQuestion(e,0,n.text,t._dateTime.getCurrentTime(),t._dateTime.getCurrentTimestamp(),null)}))},t.prototype.createMessageByChatBotButtonBased=function(){var t=this._chatBoxGetter.chatBoxSettings.chatBotButtonBased.getDisplayButtons();return new l.Message(0,null,"message-button",null,this._dateTime.getCurrentTime(),this._dateTime.getCurrentTimestamp(),null,null,null,null,null,null,null,t.buttons.toJSON(),null,null,null,null)},t.prototype.initAttachment=function(t){var e=this;this._chatBoxGetter.chatBoxSettings.behaviour.isDisableAttachments?this.getIframeDocument().querySelector("#supportBoxWebChatAttachment").style.display="none":this.getIframeDocument().querySelector("#supportBoxWebChatAttachment").addEventListener("click",(function(){e._chatBoxAttachment.attached(e.getIframeDocument(),t.id,e._user.getUserUuid(),e._chatBoxGetter.chatBoxSettings),e.getIframeDocument().querySelector("#supportBoxWebChatArea textarea").focus()}))},t.prototype.initHandeChangedAttachments=function(t,e){void 0===e&&(e=this);var n=this.getIframeDocument().querySelector("#supportBoxWebChatAttachments");new MutationObserver((function(){e.initSubmitDisable()})).observe(n,{subtree:!0,childList:!0})},t.prototype.createBlockBag=function(){var t=this.getIframeDocument().getElementById("supportBoxWebChatOpened"),e=this.getIframeDocument().getElementById("supportBoxWebChatWelcome"),n=this.getIframeDocument().getElementById("supportBoxWebChatOffline"),r=this.getIframeDocument().getElementById("supportBoxWebChatDirectMessage"),o=this.getIframeDocument().querySelector("#supportBoxWebChatInit .init-button__open-icon"),i=this.getIframeDocument().querySelector("#supportBoxWebChatInit .init-button__close-button");return new a.BlockForRendererBag(t,e,n,r,o,i)},t.prototype.showOfflineWindow=function(){var t=this.createBlockBag();this._html.removeClass(t.chatOffline,"hidden"),this._html.addClass(t.chatWindow,"hidden"),this._html.addClass(t.chatWelcome,"hidden"),this._html.addClass(t.chatDirectMessage,"hidden"),this._html.removeClass(t.openedChat,"hidden"),this._html.addClass(t.closedChat,"hidden")},t.prototype.showMessageWindow=function(){var t=this.createBlockBag();this._html.addClass(t.chatOffline,"hidden"),this._html.removeClass(t.chatWindow,"hidden"),this._html.addClass(t.chatWelcome,"hidden"),this._html.addClass(t.chatDirectMessage,"hidden"),this._html.removeClass(t.openedChat,"hidden"),this._html.addClass(t.closedChat,"hidden")},t.prototype.showWelcomeWindow=function(){var t=this.createBlockBag();this._html.addClass(t.chatOffline,"hidden"),this._html.addClass(t.chatWindow,"hidden"),this._html.removeClass(t.chatWelcome,"hidden"),this._html.addClass(t.chatDirectMessage,"hidden"),this._html.removeClass(t.openedChat,"hidden"),this._html.addClass(t.closedChat,"hidden")},t.prototype.showDirectMessageWindow=function(){var t=this.createBlockBag();this._html.addClass(t.chatOffline,"hidden"),this._html.addClass(t.chatWindow,"hidden"),this._html.addClass(t.chatWelcome,"hidden"),this._html.removeClass(t.chatDirectMessage,"hidden"),this._html.removeClass(t.openedChat,"hidden"),this._html.addClass(t.closedChat,"hidden")},t.prototype.closeWindow=function(){var t=this.createBlockBag();this._html.addClass(t.chatOffline,"hidden"),this._html.addClass(t.chatWindow,"hidden"),this._html.addClass(t.chatWelcome,"hidden"),this._html.addClass(t.chatDirectMessage,"hidden"),this._html.addClass(t.openedChat,"hidden"),this._html.removeClass(t.closedChat,"hidden")},t.prototype.redrawSize=function(){var t=this.getIframe(),e=this.getIframeDocument().querySelector("body");e.style.zoom="1",t.style.zoom="1",this._deviceDetector.isMobileDevice()||(window.innerHeight<590?(e.style.zoom="0.8",t.style.zoom="0.8"):window.innerHeight<650&&(e.style.zoom="0.9",t.style.zoom="0.9"))},t.prototype.tryFocusInput=function(t){this.isOnceFocusedInput||(t.querySelector("input").focus(),this.isOnceFocusedInput=!0)},t.prototype.tryFocusTextArea=function(t){this.isOnceFocusedTextArea||(t.querySelector("textarea").focus(),this.isOnceFocusedTextArea=!0)},t.prototype.redraw=function(t,e){var n=this,r=this.getIframeDocument(),o=r.getElementById("supportBoxWebChatOpened"),i=r.getElementById("supportBoxWebChatWelcome"),s=r.getElementById("supportBoxWebChatOffline"),a=r.querySelector("#supportBoxWebChatInit .init-button__init-message-box"),u=r.querySelector(".init-button__init-message-close-button");if(this.redrawButtonStatusText(),t.isReadyInitMessageButton(e)&&this.tryInitChatBotButtonBased(),!this._messageRepository.hasMessageFromClient()&&t&&!t.hasMessages()&&t.isStatusOpen&&t.markAsWelcome(),t.isStatusOpen&&!this.areChatVariablesEnsured()&&!this.hasSenderVariables()&&this._statusDetector.isAskUserBeforeMessage()&&t.markAsWelcome(),t.isStatusWelcome&&this.isStatusAndAskUserInfoAfterMessage()&&t.markAsOpen(),this._html.addClass(a,"hidden"),this._html.addClass(u,"hidden"),this.showInitBubble(t)&&e.initButton.showInitMessage(this._deviceDetector.isMobileDevice())){var l=r.querySelector("#supportBoxWebChatInit .init-button__init-message-text--in");l&&""!==l.innerHTML&&(this._html.removeClass(a,"hidden"),this._html.removeClass(u,"hidden"))}this.isShowOfflineWindow(t)?(this.showOfflineWindow(),this._deviceDetector.isMobileDevice()||this.tryFocusInput(s),this.redrawSize()):this.isShowDirectMessageWindow(t,e)?this.showDirectMessageWindow():this.isShowWindowMessage(t,e)?(this.showMessageWindow(),t.markAsOpen(),e.triggers.saveReadCount(),this._deviceDetector.isMobileDevice()&&(r.getElementById("supportBoxWebChatMessages").style.height="calc(100% - 155px)"),this._deviceDetector.isMobileDevice()||this.tryFocusTextArea(o),setTimeout((function(){n.runTextAreaResize()}),0)):this.isShowOnlineWindow(t)?(this.showWelcomeWindow(),e.behaviour.askUserInfoOnline?this.tryFocusInput(i):this._deviceDetector.isMobileDevice()||this.tryFocusTextArea(i),this.redrawSize()):this.closeWindow(),!t.isStatusClosed&&this._deviceDetector.isMobileDevice()?this.addClassToBody():this.removeClassToBody(),this.isShowButtonRunChatMessageWindow(t,e)&&this.showButtonRunChat(t,e),this.isRealMessageSend()&&this.initSockets();var c=r.querySelector("#supportBoxWebChatInit .init-button__unread-messages");t.countUnreadMessages>0&&t.isStatusClosed?(c.innerHTML=t.countUnreadMessages.toString(),this._html.removeClass(c,"hidden")):this._html.addClass(c,"hidden"),this.runTextAreaResize(),this.refreshIframeSize(),this.tryInitButtonScrollMessagesToBottom(),this._chatBoxStatePersister.saveStatus(t.status),this.hasMessageFromCustomer()&&this._chatBoxMenu.showEmailTranscriptionInMenu()},t.prototype.setMessageFromCustomer=function(t){this._hasMessageFromCustomer=t},t.prototype.hasMessageFromCustomer=function(){return this._hasMessageFromCustomer||this.setMessageFromCustomer(this.hasMessageTypeInMessage()||this.hasMessageButtonBasedSelected()),this._hasMessageFromCustomer},t.prototype.hasMessageTypeInMessage=function(){return!!this.getIframeDocument().querySelector("#supportBoxWebChatMessages .message-type_message-in")},t.prototype.showButtonRunChat=function(){var t=this,e=this.getIframeDocument(),n=e.querySelectorAll('#supportBoxWebChatWelcome textarea[name="message"], #supportBoxWebChatWelcome input[type="submit"], #supportBoxWebChatOffline textarea[name="message"], #supportBoxWebChatOffline input[type="submit"], #supportBoxWebChatDirectMessage textarea[name="message"], #supportBoxWebChatDirectMessage input[type="submit"]'),r=e.querySelectorAll('#supportBoxWebChatWelcome button[name="run"], #supportBoxWebChatOffline button[name="run"], #supportBoxWebChatDirectMessage button[name="run"]');n.forEach((function(t){t.classList.add("hidden")})),r.forEach((function(e){e.classList.remove("hidden"),e.addEventListener("click",(function(e){e.stopPropagation(),function(e){if(!["#supportBoxWebChatWelcome","#supportBoxWebChatOffline","#supportBoxWebChatDirectMessage"].includes(e))return!1;if(!t.buildChatVariables(e))return!1;if(t.isChatVariable("fullName")&&t.isChatVariable("email")){t._chatBoxStatePersister.saveSenderVariables(t._user.getUserUuid(),t.getChatVariables()),n.forEach((function(t){t.classList.remove("hidden")})),r.forEach((function(t){t.classList.add("hidden")}));var o=t._chatBoxGetter.chatBox,i=t._chatBoxGetter.chatBoxSettings;t.setRunMessageScrollingTimeout(!0),t.redraw(o,i),t.setRunMessageScrollingTimeout(!1)}}("#"+e.target.parentElement.getAttribute("id"))}))}))},t.prototype.isShowButtonRunChatMessageWindow=function(t,e){return t.isStatusWelcome&&!t.wasInitTicketData()&&(null==e?void 0:e.chatBotButtonBased.isChatBotButtonBasedActive())&&!this.hasSenderVariables()},t.prototype.isShowOnlineWindow=function(t){return t.isStatusWelcome},t.prototype.isShowWindowMessage=function(t,e){return(t.wasInitTicketData()||!this._statusDetector.isAskUserBeforeMessage()||this.hasSenderVariables())&&t.isReadyViewMessage(e)},t.prototype.isShowOfflineWindow=function(t){return(!t.wasInitTicketData()||this.hasSenderVariables())&&t.isStatusWelcome&&this._statusDetector.isAskUserBeforeMessageInOffline()&&!this.isChatbotActiveAndVariables()},t.prototype.isShowDirectMessageWindow=function(t,e){return!t.isStatusClosed&&!this._messageRepository.hasMessages()&&!this.hasSenderVariables()&&this.isStatusAndAskUserInfoAfterMessage()&&!(null==e?void 0:e.chatBotButtonBased.isChatBotButtonBasedActive())},t.prototype.isChatbotActiveAndVariables=function(){var t=this._chatBoxGetter.chatBoxSettings;return!!(null==t?void 0:t.chatBotButtonBased.isChatBotButtonBasedActive())&&this.hasSenderVariables()},t.prototype.hasSenderVariables=function(){return this._chatBoxStatePersister.hasSenderVariables(this._user.getUserUuid())},t.prototype.showInitBubble=function(t){return!this._chatBoxStatePersister.wasInitMessageHidden()||!t.wasInitMessageHidden},t.prototype.stopElementScrollTo=function(){this._currentAnimationScrollToElement&&cancelAnimationFrame(this._currentAnimationScrollToElement)},t.prototype.supportBoxLoadMessages=function(t,e){return r(this,void 0,void 0,(function(){var n,r,a,u,c,h,p,d,f,g,m,y,b,v;return o(this,(function(o){n=this._messageRepository.findAll(),this.getIframeDocument().getElementById("supportBoxWebChatMessages").innerHTML="",r=null;try{for(a=i(n.entries()),u=a.next();!u.done;u=a.next())c=s(u.value,2),f=c[0],(g=c[1]).type===l.Message.TYPE_FROM_CLIENT&&(r=f)}catch(t){m={error:t}}finally{try{u&&!u.done&&(y=a.return)&&y.call(a)}finally{if(m)throw m.error}}try{for(h=i(n.entries()),p=h.next();!p.done;p=h.next())d=s(p.value,2),f=d[0],(g=d[1]).type===l.Message.TYPE_CHATBOT_REACTION?this.renderReactionQuestion(e,g.id,g.message,g.time,g.timestamp,g.messageChatBotId,g.isChatBotQuestion(),g.chatBotAnswer,g.chatBotQuestionType,g.chatBotQuestionChoice):g.type===l.Message.TYPE_MESSAGE_BUTTON?(null!==r&&f<r&&g.fakeButtonSelected(),this.renderChatMessageButton(g)):(this.renderMessage(g,e),t.addMessageNumber())}catch(t){b={error:t}}finally{try{p&&!p.done&&(v=h.return)&&v.call(h)}finally{if(b)throw b.error}}return this.scrollToBottom(),[2]}))}))},t.prototype.elementScrollTo=function(t,e,n){var r=this;if(r.stopElementScrollTo(),e<0&&(e=0),0!==n){var o,i=t.scrollTop;r._currentAnimationScrollToElement=requestAnimationFrame((function s(a){o||(o=a);var u=Math.min((a-o)/n,1);t.scrollTop=i+u*(e-i),u<1?r._currentAnimationScrollToElement=requestAnimationFrame(s):t.scrollTop=e}))}else t.scrollTop=e},Object.defineProperty(t.prototype,"isRunMessageScrolling",{get:function(){return null!==this._runMessageScrolling},enumerable:!1,configurable:!0}),t.prototype.setRunMessageScrolling=function(t){this._runMessageScrolling=t},Object.defineProperty(t.prototype,"runMessageScrolling",{get:function(){return this._runMessageScrolling},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"runMessageScrollingTimeout",{get:function(){return this._runMessageScrollingTimeout},enumerable:!1,configurable:!0}),t.prototype.setRunMessageScrollingTimeout=function(t){this._runMessageScrollingTimeout=t},t.prototype.setRunMessageScrollingWaiting=function(t){var e=this;this.setRunMessageScrolling(t),this.setRunMessageScrollingTimeout(setTimeout((function(){e.setRunMessageScrolling(null)}),1200))},t.prototype.clearRunMessageScrollingTimeout=function(){this.runMessageScrollingTimeout&&(clearTimeout(this.runMessageScrollingTimeout),this.setRunMessageScrollingTimeout(!1),this.setRunMessageScrolling(null))},t.prototype.scrollToMessage=function(t){var e=this.getIframeDocument().getElementById("supportBoxWebChatMessages");if(t.classList.contains("chat-message-buttons")){if(this.isRunMessageScrolling)return void this.clearRunMessageScrollingTimeout()}else if(this.isRunMessageScrolling)return;this.isRunMessageScrolling||this.setRunMessageScrollingWaiting(t),this.scrollToOffsetTop(t,e)},t.prototype.scrollToOffsetTop=function(t,e){var n=t.offsetTop-70;this.elementScrollTo(e,n,250)},t.prototype.scrollToBottom=function(){this._chatBoxGetter.chatBox.isStatusClosed||!0!==this.runMessageScrollingTimeout&&(this.stopElementScrollTo(),this.getIframeDocument().getElementById("supportBoxWebChatMessages").scrollTop=1e5)},t.prototype.isStackedTime=function(t,e){return!!e&&!!t&&t.type===e.type&&t.isRead===e.isRead&&t.operatorId===e.operatorId&&Number(new Date(e.timestamp))-Number(new Date(t.timestamp))<120},t.prototype.tryStacked=function(t){return this.isStackedTime(this._lastMessage,t)?(this._lastMessage=t,{class:"msg-stack--"+this._stackId}):(this._stackId=this._stackId+1,this._lastMessage=t,{class:"msg-stack--"+this._stackId})},t.prototype.queryViewStacked=function(t){var e=this.getIframeDocument().getElementById("supportBoxWebChatMessages").querySelectorAll(".msg-stack--"+t);e&&(e[0]&&e[0].classList.add("msg-stack--first"),e[e.length-1]&&(e[e.length-2]&&e[e.length-2].classList.remove("msg-stack--last"),e[e.length-3]&&e[e.length-3].classList.remove("msg-stack--last"),e[e.length-1].classList.add("msg-stack--last")))},t.hasRealMessageSend=function(t){return t.type===l.Message.TYPE_FROM_OPERATOR||t.type===l.Message.TYPE_FROM_CLIENT},t.prototype.trySetRealMessageSend=function(e){!this.isRealMessageSend()&&t.hasRealMessageSend(e)&&(this.realMessageSend=!0)},t.prototype.isRealMessageSend=function(){return this.realMessageSend},t.prototype.htmlSpecialCharsDecode=function(t){if(-1!==t.indexOf("<"))return t;var e=document.createElement("div");return e.innerHTML=t,e.textContent},t.prototype.handleChatBotAnswer=function(t){var e=this,n=this.getIframeDocument(),i=n.querySelector(".message-button_yes"),s=n.querySelector(".message-button_no");null==i||i.addEventListener("click",(function(r){r.preventDefault(),n.querySelector(".message-buttons").remove(),e.sendChatBotReaction(t.message,t.id,!0,t.chatBotQuestionChoice.yes)})),null==s||s.addEventListener("click",(function(i){return r(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return i.preventDefault(),n.querySelector(".message-buttons").remove(),this.sendChatBotReaction(t.message,t.id,!1,t.chatBotQuestionChoice.no),t.chatBotQuestionType!==p.MessageChatBotQuestionType.RESULT_QUESTION?[3,2]:[4,this.resolveUserInfoWithInit()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.sendChatBotReaction=function(t,e,n,r){var o=this._chatBoxGetter.chatBox,i=new l.Message(null,null,l.Message.TYPE_CHATBOT_REACTION,this.prepareHtmlTagMessage(t),null,null,null,null,e,r,n,null,null,null,null,null,null,null),s=this._user.getUserUuid(),a=this._dateTime.getCurrentTimestamp(),u=JSON.stringify({box:o.id,secret:o.secret,type:i.type,message:i.message,uuid:s,clientIp:this._chatBoxGetter.chatBoxSettings.ipAddress,time:a,userAgent:navigator.userAgent,messageChatBotId:i.messageChatBotId,answer:n});this.initSockets(),this._conn.readyState===WebSocket.OPEN?this._conn.send(u):this._messageOutgoingQueue.insertMessage(i)},t.prototype.chatBotQuestionHtmlButtons=function(t){if(!t.chatBotQuestionChoice)return"";var e='<button class="message-button message-button_yes" value="1">'+t.chatBotQuestionChoice.yes+'</button><button class="message-button message-button_no" value="0">'+t.chatBotQuestionChoice.no+"</button>";return"👍"===t.chatBotQuestionChoice.yes&&"👎"===t.chatBotQuestionChoice.no&&(e='<button class="message-button-default message-button_yes" value="1">'+this.resolveCustomButtonGraphics("like",24,24)+'</button><button class="message-button-default message-button_no" value="0">'+this.resolveCustomButtonGraphics("dislike",24,24)+"</button>"),'<div class="message-buttons" data-question="'+t.message+'" data-message-id="'+t.id+'">'+e+"</div>"},t.prototype.renderMessage=function(t,e){this.trySetRealMessageSend(t);var n=this.tryStacked(t),r=this.getOperatorById(t.operatorId),o=t.time,i="";if(t.message&&(i+=this.renderMessageText(t,n,r,o,e)),t.attachments){var s=this,a=function(t){var e,n;return e=t.link,n=e.split(/[#?]/)[0].split(".").pop().trim(),["gif","png","jpg","jpeg","svg","ico"].find((function(t){return t===n}))?'\n                        <a href="'+t.link+'"\n                            title="'+t.name+'"\n                            target="_blank"\n                            style="display: inline-flex"\n                        >\n                            <img src="'+t.link+'" alt="attachment: '+t.name+'" />\n                        </a>\n                    ':'\n                    <a href="'+t.link+'"\n                        title="'+t.name+'"\n                        target="_blank"\n                        style="display: inline-flex"\n                    >\n                        <div>\n                            <svg height="20" width="20"\n                                style="position: absolute; opacity: 70%;"\n                            >\n                                <circle cx="10" cy="10" r="10" fill="white" />\n                            </svg>\n                            <svg width="14" height="14"\n                                style="color: black; position: relative; top 5px; margin: 3px 7px 3px 3px; opacity: 50%;"\n                                aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"\n                            >\n                               <path fill="currentColor" d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"></path>\n                            </svg>\n                        </div>\n                        <div>\n                            '+t.name+"\n                        </div>\n                    </a>"};t.attachments.forEach((function(e){i+='<div class="'+t.type+" "+n.class+'" data-message-id="'+t.id+'">',t.type===l.Message.TYPE_FROM_OPERATOR?i+='<div class="operator">'+s._avatar.buildAvatarImageByMessage(t,r)+'<span class="datetime">'+o+'</span></div><div class="message">'+a(e)+"</div>":i+='<div class="message sb-color__primary-bg sb-color__primary-border-left__before">'+a(e)+'</div><div class="datetime">'+s.renderMessageHtmlIsRead(t.isRead)+o+"</div>",i+="</div>"}))}this.appendMessage(i),this.addEventClickMessageLink(t),this.queryViewStacked(this._stackId),this.renderOperatorInHeader(t,this._chatBoxGetter.chatBoxSettings)},t.prototype.renderMessageText=function(t,e,n,r,o){var i='<div class="'+function(t){var e=t.typeModified+" ";return t.typeModified===l.Message.TYPE_TRANSCRIPTION&&(e+="message-in "),e}(t)+e.class+" message-type_"+t.type+'" data-message-id="'+t.id+'">';if(t.typeModified===l.Message.TYPE_FROM_OPERATOR)i+='<div class="operator">'+this._avatar.buildAvatarImageByMessage(t,n)+'<span class="datetime">'+r+'</span></div><div class="message">'+this.htmlSpecialCharsDecode(t.message)+"</div>",this.renderOperatorInHeader(t,o),c.ChatBoxEventOutput("supportBox:message:receive");else{var s=this.prepareHtmlTagViewMessage(t.message);"👍"===t.chatBotAnswer&&"👍"===t.message?s=this.resolveCustomButtonGraphics("like",20,20,"bright"):"👎"===t.chatBotAnswer&&"👎"===t.message&&(s=this.resolveCustomButtonGraphics("dislike",20,20,"bright")),i+='<div class="message sb-color__primary-bg sb-color__primary-border-left__before">'+this.prepareHtmlTagViewMessage(s)+"</div>",i+='<div class="datetime">'+this.renderMessageHtmlIsRead(t.isRead)+r+"</div>"}return i+"</div>"},t.prototype.addEventClickMessageLink=function(t){var e=this,n=this.getIframeDocument().getElementById("supportBoxWebChatMessages").querySelector('div[data-message-id="'+t.id+'"] a');n&&n.addEventListener("click",(function(){e.clickMessageLink(),c.ChatBoxEventOutput("supportBox:message:link:click",{url:n.getAttribute("href")})}))},t.prototype.clickMessageLink=function(){document.querySelector("body.sb_mobile")&&this.chatBoxClose()},t.prototype.chatBoxClose=function(){var t=this._chatBoxGetter.chatBox;t.markAsClose(),this._chatBoxStatePersister.saveStatus(t.status)},t.prototype.renderMessageHtmlIsRead=function(t){return'<span class="message-read'+(t?"":" hidden")+'">'+this._translator.translate("webchatMessageReadYes")+" </span>"},t.prototype.getOperatorById=function(t){var e,n,r=this._chatBoxGetter.operators,o=r[0];try{for(var s=i(r),a=s.next();!a.done;a=s.next()){var u=a.value;u.id===t&&(o=u)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return o},t.prototype.redrawOperatorStatuses=function(t,e){return r(this,void 0,Promise,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return n=this._messageRepository.findLastMessageFromOperator(),[4,this._operatorsFetcher.fetchOperators(t)];case 1:return r=o.sent(),this._chatBoxGetter.refreshOperators(r),null===n&&(n=this._messageRepository.findLast()),null!==n&&this.renderOperatorInHeader(n,e),this.redrawOperatorStatusInInitButton(),this.redraw(t,e),c.ChatBoxEventOutput("supportBox:status:change",{offline:this._statusDetector.isStatusOffline()}),[2]}}))}))},t.prototype.redrawButtonStatusText=function(){var t=this._chatBoxGetter.chatBoxSettings,e=this.getIframeDocument().getElementById("supportBoxWebChatInit"),n=e.querySelector(".init-button__button-text"),r=t.initButton.showButtonText(this._deviceDetector.isMobileDevice());this._statusDetector.hasSomeOnlineOperator()?(t.initButton.buttonTextOnline.length>0&&r?e.classList.add("init-button--with-text"):e.classList.remove("init-button--with-text"),n&&r&&(n.textContent=t.initButton.buttonTextOnline)):(t.initButton.buttonTextOffline.length>0&&r?e.classList.add("init-button--with-text"):e.classList.remove("init-button--with-text"),n&&r&&(n.textContent=t.initButton.buttonTextOffline))},t.prototype.redrawOperatorStatusInInitButton=function(){var t=this.getIframeDocument().getElementById("supportBoxWebChatInit").querySelector(".init-button__operator-status");this._statusDetector.hasSomeOnlineOperator()?null!==t&&(this._html.addClass(t,"init-button__operator-status--online"),this._html.removeClass(t,"init-button__operator-status--offline")):null!==t&&(this._html.addClass(t,"init-button__operator-status--offline"),this._html.removeClass(t,"init-button__operator-status--online"))},t.prototype.renderWritingMessage=function(t){if(null===this.getIframeDocument().getElementById("operatorWritingMessageTodo")){var e=0!==t?this.getOperatorById(t):null,n='<div class="message-typing" data-message-id="writing" id="operatorWritingMessageTodo"><div class="operator">'+this._avatar.buildAvatarSimple(e)+'<span class="datetime">teď</span></div><div class="message"><div class="dot-flashing"></div></div></div>';this.appendMessage(n),c.ChatBoxEventOutput("supportBox:operator:writing",{operator:e})}},t.prototype.removeWritingMessage=function(){var t=this.getIframeDocument().getElementById("operatorWritingMessageTodo");null!==t&&(t.parentNode.removeChild(t),c.ChatBoxEventOutput("supportBox:operator:writing:stop"))},t.prototype.operatorReadMessage=function(t,e,n){if(t.id===e){var r=this.getIframeDocument().querySelector('#supportBoxWebChatMessages .message-in[data-message-id="'+n+'"]');if(r||(r=this.getIframeDocument().querySelector('#supportBoxWebChatMessages .message-in[data-message-id="null"]')),!r)return;r.setAttribute("data-message-id",String(n));var o=r.querySelector(".message-read");if(!o)return;o.classList.remove("hidden")}},t.prototype.appendMessage=function(t){var e=this.getIframeDocument().getElementById("supportBoxWebChatMessages");this._html.appendHtml(e,t)},t.prototype.renderOperatorInHeader=function(t,e){var n=this.findOperatorForHeader(t.operatorId),r=this.getIframeDocument().getElementById("operator"),o=r.querySelector("span.name"),i=!0;e.behaviour.isDisableOperators?this._statusDetector.hasSomeOnlineOperator()?o.textContent="Online":(o.textContent="Offline",i=!1):(this.isChatbotActiveInChat(t)?(r.querySelector("img").setAttribute("src",this._avatar.getAvatarImageSimple(null)),o.textContent=this._avatar.getAvatarNameSimple(null)):(r.querySelector("img").setAttribute("src",this._avatar.getAvatarImageSimple(n)),o.textContent=this._avatar.getAvatarNameSimple(n)),n.isOnline||(i=!1));var s=r.querySelector(".operator_status");i?(this._html.removeClass(s,"operator_status--offline"),this._html.addClass(s,"operator_status--online")):(this._html.removeClass(s,"operator_status--online"),this._html.addClass(s,"operator_status--offline"))},t.prototype.findOperatorForHeader=function(t){var e,n,r,o,s,a,u=this._chatBoxGetter.operators,l=u[0];try{for(var c=i(u),h=c.next();!h.done;h=c.next())(m=h.value).id===t&&(l=m)}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}try{for(var p=i(u),d=p.next();!d.done;d=p.next())if((m=d.value).isOnline){l=m;break}}catch(t){r={error:t}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}try{for(var f=i(u),g=f.next();!g.done;g=f.next()){var m;if((m=g.value).id===t&&m.isOnline)return m}}catch(t){s={error:t}}finally{try{g&&!g.done&&(a=f.return)&&a.call(f)}finally{if(s)throw s.error}}return l},t.prototype.hideFormUserInfo=function(){this.getIframeDocument().querySelector("#supportBoxWebChatOffline").style.display=""},t.prototype.isFormUserInfoShowed=function(){return"block"===this.getIframeDocument().querySelector("#supportBoxWebChatOffline.supportBoxWebChat-window--user-info-question").style.display},t.prototype.showFormUserInfo=function(){return r(this,void 0,Promise,(function(){var t,e,n,r,i=this;return o(this,(function(o){return t=this._chatBoxGetter.chatBoxSettings,e=this.getIframeDocument().querySelector("#supportBoxWebChatOffline"),n=e.querySelector("textarea"),r=e.querySelector('input[type="submit"]'),function(){e.querySelector(".menu-btn.menu-content").style.display="none",e.querySelector("h1.sb-color__title").style.display="none",e.querySelector(".operators").style.display="none";var o=e.querySelector("h2");o.style.display="none";var i=document.createElement("h2");i.textContent=t.behaviour.askUserInfoTitle,i.classList=o.classList,i.classList.add("hide-before"),i.style.textAlign="left",i.style.padding="0 20px",e.insertBefore(i,o);var s=document.createElement("style");s.textContent=".hide-before:before {display: none !important;}",e.insertBefore(s,o);var a=e.querySelector("p.sb-color__title");a.style.display="none";var u=document.createElement("p");u.textContent=t.behaviour.askUserInfoText,u.classList.add("sb-color__title"),u.style.padding="0 20px",u.style.textAlign="left",u.style.minHeight="90px",e.insertBefore(u,a),n.style.display="none",r.style.display="none",e.style.zIndex="1",e.style.display="block"}(),e.querySelector('input[name="name"]').focus(),[2,new Promise((function(t){var n=document.createElement("button");e.querySelector(".sb-button-user-data")?n=e.querySelector(".sb-button-user-data"):(n.textContent=i._translator.translate("formButtonSendMessage"),n.setAttribute("name","run"),e.insertBefore(n,r),n.classList.add("sb-button-user-data"));var o=function(){if(u(),i.buildChatVariables("#supportBoxWebChatOffline")&&i.isChatVariable("fullName")&&i.isChatVariable("email"))return i._chatBoxStatePersister.saveSenderVariables(i._user.getUserUuid(),i.getChatVariables()),void t(!0);t(!1)},s=function(){u(),t(!1)},a=e.querySelector(".menu-btn.close"),u=function(){n.removeEventListener("click",o),a.removeEventListener("click",s)};n.addEventListener("click",o),a.addEventListener("click",s)}))]}))}))},t.prototype.resolveUserInfoWithInit=function(){return r(this,void 0,Promise,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return this.hasSenderVariables()?[2,!0]:((t=this._chatBoxGetter.chatBox).markInitTicketData(!1),[4,this.resolveUserInfo(!0)]);case 1:return e.sent()?(this.initSockets(),this.sendMessageOutgoingQueue(t),[2,!0]):[2,!1]}}))}))},t.prototype.resolveUserInfo=function(t){return r(this,void 0,Promise,(function(){var e=this;return o(this,(function(n){return[2,new Promise((function(n){return r(e,void 0,void 0,(function(){var e,r;return o(this,(function(o){switch(o.label){case 0:return e=this._chatBoxGetter.chatBoxSettings,this._chatBoxGetter.chatBox.wasInitTicketData()&&this.hasSenderVariables()?(n(!0),[2]):!this.isStatusAndAskUserInfoAfterMessage()||!t&&e.behaviour.askUserInfoByChatbot?[3,2]:[4,this.showFormUserInfo()];case 1:if(r=o.sent(),this.hideFormUserInfo(),!r)return n(!1),[2];this._chatBoxStatePersister.saveText(""),o.label=2;case 2:return n(!0),[2]}}))}))}))]}))}))},t.prototype.isStatusAndAskUserInfoAfterMessage=function(){var t=this._chatBoxGetter.chatBoxSettings,e=this._statusDetector.isStatusOperatorOffline();return(t.behaviour.askUserInfoOnline||t.behaviour.askUserInfoOffline)&&(!e&&t.behaviour.askUserInfoOnlineAfterMessage||e&&t.behaviour.askUserInfoOfflineAfterMessage)},t.prototype.initSockets=function(){return r(this,void 0,void 0,(function(){var t,e,n,r=this;return o(this,(function(o){return null!==this._conn||(t=this._chatBoxGetter.chatBox,e=this._chatBoxGetter.chatBoxSettings,this._conn=new WebSocket(t.endPoint),this._conn.onmessage=function(n){var o=JSON.parse(n.data);if("message-in"===o.type&&(r._chatState.isResolved=!1),"operator-writing"===o.type){var i=r.getIframeDocument().getElementById("supportBoxWebChatMessages").scrollHeight,s=r.getIframeDocument().getElementById("supportBoxWebChatMessages").clientHeight,a=r.getIframeDocument().getElementById("supportBoxWebChatMessages").scrollTop;r.renderWritingMessage(o.operatorId),i-s-30<=a&&r.scrollToBottom()}else"operator-stop-writing"===o.type?r.removeWritingMessage():"operator-read-message"===o.type?r.operatorReadMessage(t,o.chatBoxId,o.messageId):"chat-online-status-change"===o.type?r.redrawOperatorStatuses(t,e):o.type===l.Message.TYPE_CHATBOT_REACTION?null===o.answer?r.processChatBotQuestionMessage(o,e):r.processChatBotAnswerMessage(o,e):o.type===l.Message.TYPE_MESSAGE_BUTTON?r.processRenderChatMessageButton(o,e):(t.isOpenWindow||(t.addMissingMessage(),r.redraw(t,e)),r.processGenericMessage(o,t,e));r.refreshChatBotButtonBased(e),o.type===l.Message.TYPE_FROM_CLIENT&&(r.fakeButtonSelectedInDOM(),r.setMessageFromCustomer(!0),r._chatBoxMenu.showEmailTranscriptionInMenu())},n=this._conn,this._conn.onopen=function(){var e=r._cookie.getCookie(r._cookie.getCookieName());null===e&&console.error("SupportBox: Customer chat id not available. Please allow cookie supportbox_chat_id in CookieConsent tool and check the cookie settings.");var o=JSON.stringify({box:t.id,secret:t.secret,type:"handshake-customer",customer:e});n.send(o),r.sendMessageOutgoingQueue(t),r._lastVisitUrlSender.sendLastVisitUrl(t,r._user.getUserUuid())},this._conn.onclose=function(){setTimeout((function(){r._conn=null,r.initSockets()}),1e3)},this._conn.onerror=function(){r._conn.close()}),[2]}))}))},t.prototype.fakeButtonSelectedInDOM=function(){var t=this._chatBoxGetter.chatBoxSettings;if(null==t?void 0:t.chatBotButtonBased.isChatBotButtonBasedActive()){var e=this.getMessageButtonBasedWithoutSelected();e&&e.setAttribute("data-button-selected","0")}},t.prototype.processChatBotQuestionMessage=function(t,e){return r(this,void 0,void 0,(function(){var n=this;return o(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(t){return setTimeout(t,1e3*n.chatBotMessageDelayInSeconds)}))];case 1:return r.sent(),this.renderReactionQuestion(e,t.id,t.message,t.time,t.timestamp,t.chatBotId,t.isQuestion,null,t.questionType,t.questionChoice),[2]}}))}))},t.prototype.processChatBotAnswerMessage=function(t,e){return r(this,void 0,void 0,(function(){var n;return o(this,(function(r){return n=new l.Message(t.id,null,l.Message.TYPE_FROM_CLIENT,t.answer,t.time,t.timestamp,[],null,t.chatBotId,t.answer,t.answerIsPositive,null,null,null,null,null,null,!0),this.renderReactionAnswer(e,n),[2]}))}))},t.prototype.processGenericMessage=function(t,e,n){return r(this,void 0,void 0,(function(){var r,i=this;return o(this,(function(o){switch(o.label){case 0:return"message-in"===(r=new l.Message(t.id,t.operatorId,t.type,t.message,t.time,t.timestamp,t.attachments,t.triggerId,t.chatBotId,t.chatBotAnswer,t.chatBotAnswerIsPositive,t.chatBotQuestionType,t.chatBotQuestionChoice,t.buttons,t.buttonSelected,t.buttonId,t.buttonChatBot,t.isRead)).type&&this.getIframeDocument().querySelectorAll(".message-buttons").forEach((function(t){t.remove()})),r.type!==l.Message.TYPE_CHATBOT?[3,2]:[4,new Promise((function(t){return setTimeout(t,1e3*i.chatBotMessageDelayInSeconds)}))];case 1:o.sent(),o.label=2;case 2:return this._messageRepository.add(r),this.removeWritingMessage(),this.renderMessage(r,n),"message-in"===r.type||(this._chatBoxClientSound.init(e,n),this._chatBoxClientSound.play(),this.refreshChatBotButtonBased(n)),[2]}}))}))},t.prototype.renderReactionQuestion=function(t,e,n,r,o,i,s,a,u,c){void 0===s&&(s=!1),void 0===a&&(a=null),void 0===u&&(u=null),void 0===c&&(c=null),s&&this.getIframeDocument().getElementById("supportBoxWebChatMessages").querySelectorAll(".message-buttons").forEach((function(t){t.remove()}));var h=new l.Message(e,null,l.Message.TYPE_CHATBOT_REACTION,n,r,o,[],null,i,a,null,u,c,null,null,null,null,!0);if(this.renderMessage(h,t),h.isChatBotQuestion())this.renderReactionAnswerButtons(t,h);else if(null!==h.chatBotAnswer){var p={id:h.id,answer:h.chatBotAnswer,time:h.time,timestamp:h.timestamp};this.processChatBotAnswerMessage(p,t)}},t.prototype.renderReactionAnswerButtons=function(t,e){var n=this,r=this.chatBotQuestionHtmlButtons(e),o=document.createElement("div");o.className="chat-message-buttons",o.style.display="flex",o.style.flexWrap="wrap",o.style.justifyContent="flex-end",o.style.marginBottom="10px",o.innerHTML=r,o.querySelectorAll(".message-buttons button").forEach((function(e){var r;(r=e).style.verticalAlign="middle",r.style.margin="5px",r.style.padding="10px",r.style.backgroundColor="white",r.style.border="1px solid "+t.color.primary,r.style.color=t.color.primary,r.style.borderRadius="5px",r.style.cursor="default",e.addEventListener("mouseenter",(function(){e.parentElement.dataset.buttonSelected||(e.dataset.originalColor=e.style.backgroundColor,e.style.backgroundColor=n.hexToRgba(t.color.primary,.1),e.style.cursor="pointer")})),e.addEventListener("mouseleave",(function(){e.parentElement.dataset.buttonSelected||(e.style.backgroundColor=e.dataset.originalColor,e.style.cursor="default")}))})),this.getIframeDocument().getElementById("supportBoxWebChatMessages").appendChild(o),this.handleChatBotAnswer(e)},t.prototype.renderReactionAnswer=function(t,e){this.renderMessage(e,t),this.scrollToBottom()},t.prototype.sendChatBotButtonNew=function(t){var e=this._chatBoxGetter.chatBox,n=this._chatBoxGetter.chatBoxSettings.chatBotButtonBased.getDisplayButtons(),r=new l.Message(null,null,l.Message.TYPE_MESSAGE_BUTTON_NEW,"",null,null,null,null,null,null,null,null,null,null,t,null,n.id,null),o=this._user.getUserUuid(),i=this._dateTime.getCurrentTimestamp(),s=JSON.stringify({box:e.id,secret:e.secret,type:r.type,uuid:o,clientIp:this._chatBoxGetter.chatBoxSettings.ipAddress,time:i,userAgent:navigator.userAgent,buttonSelected:r.buttonSelected,buttonChatBot:r.buttonChatBot});this.initSockets(),this._conn.readyState===WebSocket.OPEN?this._conn.send(s):this._messageOutgoingQueue.insertMessage(r)},t.prototype.sendChatBotButtonSelect=function(t,e){if(null!==t&&null!==e){var n=this._chatBoxGetter.chatBox,r=new l.Message(null,null,l.Message.TYPE_MESSAGE_BUTTON_SELECT,"",null,null,null,null,null,null,null,null,null,null,e,t,null,null),o=this._user.getUserUuid(),i=this._dateTime.getCurrentTimestamp(),s=JSON.stringify({box:n.id,secret:n.secret,type:r.type,uuid:o,clientIp:this._chatBoxGetter.chatBoxSettings.ipAddress,time:i,userAgent:navigator.userAgent,buttonSelected:r.buttonSelected,buttonId:r.buttonId});this.initSockets(),this._conn.readyState===WebSocket.OPEN?this._conn.send(s):this._messageOutgoingQueue.insertMessage(r)}},t.prototype.hexToRgba=function(t,e){void 0===e&&(e=1);var n=function(t){t=t.replace("#","");var e=parseInt(t,16);return[e>>16&255,e>>8&255,255&e]}(t);return"rgba("+n[0]+", "+n[1]+", "+n[2]+", "+e+")"},t.prototype.removeChatBotButtonBasedInitMessages=function(){this.getIframeDocument().getElementById("supportBoxWebChatMessages").querySelectorAll('#supportBoxWebChatMessages .chat-message-buttons[data-id="0"], #supportBoxWebChatMessages .message-out.message-type_message-chatbot[data-message-id="0"], #supportBoxWebChatMessages .message-out.message-type_message-chatbot-reaction[data-message-id="0"]').forEach((function(t){t.remove()}))},t.prototype.processRenderChatMessageButton=function(t,e){return r(this,void 0,void 0,(function(){var n=this;return o(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(t){return setTimeout(t,1e3*n.chatBotMessageDelayInSeconds)}))];case 1:return r.sent(),this.renderChatMessageButton(t),this.removeChatBotButtonBasedInitMessages(),this.renderChatBotButtonBased(e),[2]}}))}))},t.prototype.renderChatMessageButton=function(t){var e,n,s,a,u=this,l=this._chatBoxGetter.chatBoxSettings,c=JSON.parse(t.buttons),p=function(t){t.style.cursor="default",t.style.backgroundColor=u.hexToRgba(l.color.primary,1),t.style.color="white"},d=function(e){var n=document.createElement("div");return n.className="chat-message-button",function(t){t.style.verticalAlign="middle",t.style.margin="5px",t.style.padding="10px",t.style.backgroundColor="white",t.style.border="1px solid "+l.color.primary,t.style.color=l.color.primary,t.style.borderRadius="5px",t.style.cursor="default"}(n),t.buttonSelected||function(e){e.addEventListener("mouseenter",(function(){e.parentElement.dataset.buttonSelected||(e.dataset.originalColor=e.style.backgroundColor,e.style.backgroundColor=u.hexToRgba(l.color.primary,.1),e.style.cursor="pointer")})),e.addEventListener("mouseleave",(function(){e.parentElement.dataset.buttonSelected||(e.style.backgroundColor=e.dataset.originalColor,e.style.cursor="default")})),e.addEventListener("click",(function(){return r(u,void 0,void 0,(function(){var n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return e.parentElement.dataset.buttonSelected?[2]:(n=e.dataset,r=n.id,i=n.buttonSelected,r===i?[2]:(n.buttonSelected=r,n.type===h.ChatBoxSettingsChatBotButtonBasedButtonType.Link&&n.url&&((s=document.createElement("a")).setAttribute("href",n.url),s.setAttribute("target","_blank"),s.click()),n.type!==h.ChatBoxSettingsChatBotButtonBasedButtonType.Operator?[3,2]:[4,this.resolveUserInfoWithInit()]));case 1:if(!o.sent())return n.buttonSelected=void 0,[2];l.chatBotButtonBased.switchToOperator(),o.label=2;case 2:return(null==t?void 0:t.id)?this.sendChatBotButtonSelect(t.id,r):"resetChatBot"===r?(a=l.chatBotButtonBased.getDisplayButtons(),this.renderReactionQuestion(l,0,a.askAnotherQuestion,this._dateTime.getCurrentTime(),this._dateTime.getCurrentTimestamp(),null),this.renderChatMessageButton(this.createMessageByChatBotButtonBased())):r&&(this.sendChatBotButtonNew(r),this.setMessageFromCustomer(!0),this._chatBoxMenu.showEmailTranscriptionInMenu()),e.parentElement.dataset.buttonSelected=r,p(e),[2]}}))}))}))}(n),n.setAttribute("data-id",e.id),n.setAttribute("data-type",e.type),n.setAttribute("data-url",e.url),n.innerText=e.title,n},f=document.createElement("div");f.className="chat-message-buttons",f.style.display="flex",f.style.flexWrap="wrap",f.style.justifyContent="flex-end",f.style.marginBottom="5px",f.dataset.id=null!==(s=t.id)&&void 0!==s?s:"",f.dataset.buttonSelected=null!==(a=t.buttonSelected)&&void 0!==a?a:"";try{for(var g=i(c),m=g.next();!m.done;m=g.next()){var y=m.value,b=d(y);f.appendChild(b),t.buttonSelected==y.id&&p(b)}}catch(t){e={error:t}}finally{try{m&&!m.done&&(n=g.return)&&n.call(g)}finally{if(e)throw e.error}}this.getIframeDocument().getElementById("supportBoxWebChatMessages").appendChild(f),this.tryStacked(t)},t.prototype.sendMessageOutgoingQueue=function(t){if(this._conn.readyState===WebSocket.OPEN){var e=this._user.getUserUuid(),n=this;new Promise((function(t){return t()})).then((function(){n._chatBoxGetter.chatBoxSettings.triggers.sendNewTriggers()})).then((function(){for(var r=n._messageOutgoingQueue.findFirstUnsentMessage();null!==r;){var o=r;o.box=t.id,o.type=o.type?o.type:"customer-writing",o.secret=t.secret,o.uuid=e,o.clientIp=n._chatBoxGetter.chatBoxSettings.ipAddress,n._conn.send(JSON.stringify(o)),r=n._messageOutgoingQueue.findFirstUnsentMessage()}})).then((function(){n._messageRepository.hasMessageFromPeople()||t.markInitTicketData("false"),setTimeout((function(){n._variableSender.sendVariablesWithSocket(t.wasInitTicketData(),n._conn,t,e,n.getChatVariables()),n._lastVisitUrlSender.sendLastVisitUrl(t,e)}),100)}))}},t.prototype.initPingRequestSender=function(){var t=this;setInterval((function(){var e=JSON.stringify({box:t._chatBoxGetter.chatBox.id,secret:t._chatBoxGetter.chatBox.secret,type:"ping"});null!==t._conn&&t._conn.send(e)}),55e3)},t.getSupportBoxChatVariable=function(t){return"object"!=typeof supportBoxChatVariables||"string"!=typeof supportBoxChatVariables[t]||"email"===t&&"client@email.tld"===supportBoxChatVariables[t]||"fullName"===t&&"John Doe"===supportBoxChatVariables[t]||"phone"===t&&"123456789"===supportBoxChatVariables[t]?null:'value="'+supportBoxChatVariables[t]+'"'},t.UtmTags=function(){var t=window.location.hostname.split(".");return t.length>2&&t.shift(),"?utm_source=chat&utm_medium=widget&utm_campaign="+t.join(".")},t.prototype.renderHtmlStructures=function(t,e,n){var r,o,s=this._chatBoxGetter.operators,a=this.createHtmlForInitButton(e,t,n),u='<div class="operators">',l=3;n.behaviour.isDisableOperators&&(l=0);var c=null,h=null;try{for(var p=i(s),d=p.next();!d.done;d=p.next()){var f=d.value;if(0===l)break;if(!n.behaviour.hideOfflineOperators||f.isOnline){l--;var g=this._avatar.getAvatarNameSimple(f),m=this._avatar.getAvatarImageSimple(f);c===g&&h===m||(c=g,h=m,u+='<div class="operator sb-color__title">'+this._avatar.buildAvatarSimple(f)+g+"</div>")}}}catch(t){r={error:t}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(r)throw r.error}}u+="</div>";var y=this.createHtmlForWelcomeWindow(n,u),b=this.createHtmlForOpenedWindow(n),v=this.createHtmlForOfflineWindow(n,u),_=this.createHtmlForDirectMessageWindow(n,u),B="";this._deviceDetector.isMobileDevice()&&(B="mobile");var x="<style>";x+=".sb-color__primary-bg { background-color: "+n.color.primary+" !important }",x+="input.sb-color__primary-bg:disabled { background-color: silver !important }",x+="input.sb-color__primary-bg:disabled { background-color: silver !important }",x+=".sb-color__primary-border-left__before::before { border-left-color: "+n.color.primary+" !important }",x+=".supportBoxWebChat-window--user-info-question::after { border-color: "+n.color.primary+" transparent transparent transparent !important }",x+=".sb-color__title { color: "+n.color.title+" !important }",x+=".dot-flashing { background-color: "+n.color.primary+" !important }";var S='<div id="supportBoxWebChat" class="'+B+'">'+a+y+b+v+_+(x+="</style>")+"</div>",C="<html><head><base target='_top'><link rel='stylesheet' type='text/css' href='"+e+"/assets/webChat.css?ver="+t.config.version+"'><link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,600&subset=latin,latin-ext'></head><body class='supportbox-position--"+n.initButton.positionArea+"'>"+S+"<style>#supportBoxWebChat .hidden{display:none;}</style></body></html>",w=document.createElement("iframe");w.id="supportBox-iframe",w.style.border="0 none",w.style.position="fixed",w.style.bottom="0",w.style[n.initButton.positionArea]="0",w.style.zIndex="111000",w.style.maxWidth="100%",document.body.appendChild(w),w.contentWindow.document.open(),w.contentWindow.document.write(C),w.contentWindow.document.close(),this.initChatBoxAttachment(),this.refreshIframeSize()},t.prototype.initChatBoxAttachment=function(){this._chatBoxAttachment.setAttachments(this._chatBoxStatePersister.getAttachments()),this._chatBoxAttachment.viewAttachments(this.getIframeDocument(),this._user.getUserUuid())},t.prototype.createHtmlForInitButton=function(t,e,n){var r,o=["sb-color__primary-bg","init-button"],i=this._deviceDetector.isMobileDevice(),s="";n.initButton.showButtonText(i)&&(s=n.initButton.buttonTextOnline,this._statusDetector.isStatusOffline()&&(s=n.initButton.buttonTextOffline),""!==s&&o.push("init-button--with-text")),r='<span class="init-button__button-text">'+s+"</span>";var a='<div id="supportBoxWebChatInit" class="'+o.join(" ")+'">';if(a+=r,a+='<img src="'+t+'/assets/build/image/chat.svg?v3" class="init-button__open-icon hidden">',a+='<span class="init-button__close-button hidden">&#10005;</span>',n.initButton.showStatus(i)&&!this._statusDetector.isStatusOffline()){var u="init-button__operator-status--online";this._statusDetector.hasSomeOnlineOperator()||(u="init-button__operator-status--offline"),a+='<span class="init-button__operator-status '+u+'"></span>'}var l=["init-button__init-message-text"];return n.behaviour.isDisableOperators||l.push("init-button__init-message-text--with-operators"),a+='<div class="init-button__init-message-box">',a+='   <div class="'+l.join(" ")+'">',a+="       "+this.buildHtmlOperator(n),a+="       <div>",a+='         <div class="init-button__init-message-close-button hidden">&#10005;</div>',a+='         <div class="init-button__init-message-text--in">'+n.initButton.initMessage+"</div>",a+="       </div>",a+="   </div>",a+="</div>",(a+='<div class="init-button__unread-messages hidden"></div>')+"</div>"},t.prototype.buildHtmlOperator=function(t){var e,n,r="";if(!t.behaviour.isDisableOperators){var o=this._chatBoxGetter.operators;try{for(var s=i(o),a=s.next();!a.done;a=s.next()){var u=a.value;if(u.isOnline){r='<div class="init-button__init-message-operator">',t.behaviour.isShowAvatarInTrigger?r+=this._avatar.buildBotAvatarImage()+this._avatar.getBotAvatarName():r+=this._avatar.buildAvatarSimple(u)+this._avatar.getAvatarNameSimple(u),r+="</div>";break}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}}return r},t.prototype.createButtonScrollMessagesToBottom=function(){var t=this,e=this._chatBoxGetter.chatBoxSettings,n=e.color.primary,r=document.createElement("div");r.innerHTML='<svg aria-hidden="true" fill="none" height="18" viewBox="7 7 22 22" width="18"><path d="M24.616 18.366a1.25 1.25 0 011.768 1.768l-7.5 7.5a1.25 1.25 0 01-1.768 0l-7.5-7.5a1.25 1.25 0 011.768-1.768l4.94 4.94a.25.25 0 00.426-.177V9.25a1.25 1.25 0 112.5 0v13.879c0 .222.27.334.427.176l4.94-4.939z" fill="'+n+'"></path></svg>',r.style.backgroundColor="#fff",r.style.padding="10px",r.style.borderRadius="50%";var o,i=document.createElement("div");i.id="scroll-down-arrow",i.style.position="absolute",i.style.zIndex="1",i.style.visibility="hidden",i.style.verticalAlign="middle",i.style.backgroundColor="#fff",i.style.border="1px solid "+e.color.primary,i.style.borderRadius="50%",i.style.cursor="pointer",i.style.opacity="0",i.style.transition="opacity 0.3s",i.style.width="38px",i.style.height="38px",i.style.marginTop=this._deviceDetector.isMobileDevice()?"-55px":"-50px",i.appendChild(r),(o=this.getIframeDocument().querySelector("#supportBoxWebChatOpened")).offsetWidth||(o=this.getIframeDocument().querySelector("#supportBoxWebChatDirectMessage"));var s=o.offsetWidth;return i.style.left=String(Math.round(s/2)-20)+"px",i.addEventListener("mouseenter",(function(){r.style.backgroundColor=t.hexToRgba(e.color.primary,.1)})),i.addEventListener("mouseleave",(function(){r.style.backgroundColor="#fff"})),i.addEventListener("click",(function(){t.scrollToBottom()})),i},t.prototype.tryInitButtonScrollMessagesToBottom=function(){var t=this;if(this._chatBoxGetter.chatBox.isStatusOpen){var e=this.getIframeDocument().querySelector("#supportBoxWebChatOpened");setTimeout((function(){if(!e.querySelector("#scroll-down-arrow")){var n=e.querySelector("#supportBoxWebChatMessages");t.initButtonScrollMessagesToBottom(n)}}),500)}},t.prototype.initButtonScrollMessagesToBottom=function(t){var e=this.createButtonScrollMessagesToBottom();t.parentNode.insertBefore(e,t.nextSibling);var n=function(){t.scrollTop+t.clientHeight+5>=t.scrollHeight?(e.style.opacity="0",e.style.visibility="hidden"):(e.style.visibility="visible",e.style.opacity="1")};t.addEventListener("scroll",(function(){n()})),n()},t.prototype.createHtmlForOpenedWindow=function(t){var e=this._chatBoxGetter.operators,n=new u.Operator(0,this._translator.translate("operatorDefaultName"),"",!1),r="",o="operator_status--online";if(t.behaviour.isDisableOperators||0===e.length){if(t.behaviour.isDisableOperators){var i="Online";this._statusDetector.hasSomeOnlineOperator()||(i="Offline",o="operator_status--offline"),r+='<span class="name sb-color__title">'+i+"</span>",r+='<span class="operator_status '+o+'"></span>'}}else(n=e[0]).isOnline||(o="operator_status--offline"),r=this._avatar.buildAvatarSimple(n)+'<span class="name sb-color__title">'+this._avatar.getAvatarNameSimple(n)+'</span><span class="operator_status '+o+'"></span>';return'<div id="supportBoxWebChatOpened" class="hidden"><div id="operator" class="'+(t.behaviour.isDisableOperators?"operator--disable-list":"")+'">'+r+"</div>"+this._chatBoxMenu.createHtmlMenu(!1)+'<div id="supportBoxWebChatHeader" class="sb-color__primary-bg"><div class="sb-color__title title">'+t.openedTitle+'</div></div><div id="supportBoxWebChatMessages"></div><div id="supportBoxWebChatArea"><textarea name="message" rows="1" placeholder="'+t.areaPlaceholder+'">'+this._chatBoxStatePersister.getText()+'</textarea><svg id="supportBoxWebChatAttachment" class="sb-attachment" width="25px" height="35px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" preserveAspectRatio="xMidYMid meet" viewBox="0 0 1408 1536"><path d="M1404 1257q0 117-79 196t-196 79q-135 0-235-100L117 656Q4 541 4 385q0-159 110-270T383 4q158 0 273 113l605 606q10 10 10 22q0 16-30.5 46.5T1194 822q-13 0-23-10L565 205q-79-77-181-77q-106 0-179 75t-73 181q0 105 76 181l776 777q63 63 145 63q64 0 106-42t42-106q0-82-63-145L633 531q-26-24-60-24q-29 0-48 19t-19 48q0 32 25 59l410 410q10 10 10 22q0 16-31 47t-47 31q-12 0-22-10L441 723q-63-61-63-149q0-82 57-139t139-57q88 0 149 63l581 581q100 98 100 235z" fill="currentColor"/></svg><input type="submit" class="sb-color__primary-bg" value="&rarr;"></div><div class="supportBoxWebChat-love-light"><div id="supportBoxWebChatAttachments"></div>'+this.promoLinkCreateWithLove()+"</div></div>"},t.prototype.promoLinkCreateWithLove=function(){return this._chatBoxGetter.chatBoxSettings.initButton.hidePromo?'<a href="https://supportbox.cz/live-chat/'+t.UtmTags()+'" target="_blank" style="visibility:hidden;">&nbsp;</a>':'<a href="https://supportbox.cz/live-chat/'+t.UtmTags()+'" target="_blank">'+this._translator.translate("footerCreatedWithLove")+' <span class="blue">'+this._translator.translate("footerPoweredBy")+"</span></a>"},t.prototype.createHtmlForWelcomeWindow=function(t,e){return t.behaviour.askUserInfoOnline?this.createHtmlForAskUserWindow(t,e,t.welcomeTitle,t.welcomeSubtitle,t.welcomeResponseTime,!1):this.createHtmlForWelcomeShortWindow(t,e)},t.prototype.createHtmlForWelcomeShortWindow=function(t,e){return'<div id="supportBoxWebChatWelcome" class="supportBoxWebChat-window sb-color__primary-bg supportBoxWebChat-window--welcome hidden">'+this._chatBoxMenu.createHtmlMenu()+'<h1 class="sb-color__title">'+t.welcomeTitle+'</h1><h2 class="sb-color__title subtitle subtitle--online">'+t.welcomeSubtitle+"</h2>"+e+'<p class="sb-color__title">'+t.welcomeResponseTime+'</p><textarea name="message" rows="1" placeholder="'+t.areaPlaceholder+'"></textarea><input type="submit" class="sb-color__primary-bg" value="&rarr;"><div class="supportBoxWebChat-love-light">'+this.promoLinkCreateWithLove()+"</div></div>"},t.prototype.createHtmlForDirectMessageWindow=function(t,e){var n=this._statusDetector.isStatusOffline(),r=n?"subtitle--offline":"subtitle--online",o=n?t.offline.title:t.welcomeTitle,i=n?t.offline.subtitle:t.welcomeSubtitle,s=n?t.offline.responseTime:t.welcomeResponseTime;return'<div id="supportBoxWebChatDirectMessage" class="supportBoxWebChat-window sb-color__primary-bg supportBoxWebChat-window--welcome hidden">'+this._chatBoxMenu.createHtmlMenu()+'<h1 class="sb-color__title">'+o+'</h1><h2 class="sb-color__title subtitle '+r+'">'+i+"</h2>"+e+'<p class="sb-color__title">'+s+'</p><textarea name="message" rows="1" placeholder="'+t.areaPlaceholder+'"></textarea><input type="submit" class="sb-color__primary-bg" value="&rarr;"><div class="supportBoxWebChat-love-light">'+this.promoLinkCreateWithLove()+"</div></div>"},t.prototype.createHtmlForOfflineWindow=function(t,e){return this.createHtmlForAskUserWindow(t,e,t.offline.title,t.offline.subtitle,t.offline.responseTime,!0)},t.prototype.createHtmlForAskUserWindow=function(e,n,r,o,i,s){var a="subtitle--online",u="supportBoxWebChatWelcome";return s&&(a="subtitle--offline",u="supportBoxWebChatOffline"),'<div id="'+u+'" class="supportBoxWebChat-window sb-color__primary-bg supportBoxWebChat-window--user-info-question hidden">'+this._chatBoxMenu.createHtmlMenu()+'<h1 class="sb-color__title">'+r+'</h1><h2 class="sb-color__title subtitle '+a+'">'+o+"</h2>"+n+'<p class="sb-color__title">'+i+'</p><input type="text" name="name" placeholder="'+e.offline.placeholderName+'"'+t.getSupportBoxChatVariable("fullName")+'><input type="text" name="email" class="supportBoxWebChat-window__invalid-data" placeholder="'+e.offline.placeholderEmail+'"'+t.getSupportBoxChatVariable("email")+'><input type="text" name="phone" placeholder="'+e.offline.placeholderPhone+'"'+t.getSupportBoxChatVariable("phone")+'><textarea name="message" placeholder="'+e.offline.placeholderMessage+'"></textarea><button name="run" class="hidden">'+this._translator.translate("buttonBasedChatbotRunChat")+'</button><input type="submit" class="sb-color__primary-bg" value="&rarr;"><div class="supportBoxWebChat-love-dark">'+this.promoLinkCreateWithLove()+"</div></div>"},t.prototype.addStylesToPrimaryDocument=function(){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode("body.sb_mobile {position: fixed;top: 0;left: 0;bottom: 0;right: 0;height: 100%;overflow: hidden;}")),document.head.appendChild(t)},t.prototype.addClassToBody=function(){document.body.classList.add(this.classPrimaryDocument)},t.prototype.removeClassToBody=function(){document.body.classList.remove(this.classPrimaryDocument)},t.prototype.getIframe=function(){return document.getElementById("supportBox-iframe")},t.prototype.getIframeDocument=function(){return this.getIframe().contentWindow.document},t.prototype.refreshIframeSize=function(){var t=this.getIframe(),e=this.showInitBubble(this._chatBoxGetter.chatBox),n=this._iframeSizeCalculator.getSizeInPixels(t,e);t.style.width=n.width+"px",t.style.height=n.height+"px"},t.prototype.initHandles=function(t,e){this.initObserverMessages(),this.initTicketData(t),this.initHandleOnClosedClick(t,e),this.initHandleOnClickCloseInitMessage(),this.initHandleOnClickButtonForWelcomeAndOpen(t,e),this.initHandleOnClickButtonForOffline(t,e),this.initHandlePressCtrlEnter(),this.initTextAreaResize(t),this.initHandleWelcomeOnClickClose(t,e),this.initHandleMenu(t,e),this.initHandleResizeScreen(t,e),this.initHandeChangedAttachments(t),this.initSubmitDisable(),this.initTriggers(t,e),this.initSendInfoAboutRead()},t.prototype.initTicketData=function(t){var e;if(!this._messageRepository.hasMessageFromPeople()&&(t.markInitTicketData("false"),this.hasSenderVariables())){var n=this._user.getUserUuid(),r=this._chatBoxStatePersister.getSenderVariables(n);this.setSupportBoxChatVariable("email",r.email),this.setSupportBoxChatVariable("fullName",r.fullName),this.setSupportBoxChatVariable("phone",r.phone)}this.hasSenderVariables()||(null===(e=this.findOperatorForHeader())||void 0===e?void 0:e.isOnline)&&!this._chatBoxGetter.chatBoxSettings.behaviour.askUserInfoOnline||t.markInitTicketData("false")},t.prototype.initObserverMessages=function(){var t=this,e=this.getIframeDocument().getElementById("supportBoxWebChatMessages");new MutationObserver((function(n,r){var o,s;try{for(var a=i(n),u=a.next();!u.done;u=a.next()){var l=u.value;if("childList"===l.type&&l.addedNodes.length>0){var c=l.addedNodes[0];if("scroll-down-arrow"===c.getAttribute("id"))return;if(t.isRunMessageScrolling&&e.contains(t.runMessageScrolling)&&t.scrollToOffsetTop(t.runMessageScrolling,e),c.classList.contains("message-in"))t.scrollToBottom();else if(c.classList.contains("chat-message-buttons")){if(c.getAttribute("data-button-selected"))return t.setRunMessageScrolling(null),void t.stopElementScrollTo();if(c.querySelector('[data-type="reset"]'))return;t.scrollToMessage(c)}else t.scrollToMessage(c)}}}catch(t){o={error:t}}finally{try{u&&!u.done&&(s=a.return)&&s.call(a)}finally{if(o)throw o.error}}})).observe(e,{childList:!0,subtree:!0})},t.prototype.initTriggers=function(t,e){e.triggers.init(this,t,e),e.triggers.run(t,e)},t.prototype.initHandleResizeScreen=function(t,e){var n,r,o=this;try{for(var s=i(["resize"]),a=s.next();!a.done;a=s.next()){var u=a.value;window.addEventListener(u,(function(){o.redraw(t,e)}))}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}this.getIframeDocument().addEventListener("focusout",(function(){o.redraw(t,e)}))},t.prototype.initHandleWelcomeOnClickClose=function(t,e){var n=this;this.getIframeDocument().querySelectorAll(".close, .menu-minimize").forEach((function(r){r.addEventListener("click",(function(){n.isFormUserInfoShowed()?n.hideFormUserInfo():(t.markAsClose(),n.redraw(t,e))}))}))},t.prototype.initHandleMenu=function(t,e){this._chatBoxMenu.init(this.getIframeDocument(),t,e,this._translator)},t.prototype.initHandleOnClosedClick=function(t,e){var n=this;this.getIframeDocument().getElementById("supportBoxWebChatInit").onclick=function(){n.toggleChatbox(t,e)}},t.prototype.tryRefreshNewChat=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return"only-online"===this._chatBoxGetter.chatBoxSettings.behaviour.onlineStatus||"only-offline"===this._chatBoxGetter.chatBoxSettings.behaviour.onlineStatus||this._messageRepository.hasMessageFromPeople()?[2]:[4,this.redrawOperatorStatuses(this._chatBoxGetter.chatBox,this._chatBoxGetter.chatBoxSettings)];case 1:return t.sent(),[2]}}))}))},t.prototype.toggleChatbox=function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return t.isStatusClosed?[4,this.tryRefreshNewChat()]:[3,2];case 1:return n.sent(),t.openSomeWindowAndSetStatus(this._statusDetector.isStatusOffline(),e,this._messageRepository.hasMessageFromClient(),this.hasSenderVariables()),this._statusDetector.isStatusOffline()?(this.showOfflineWindow(),c.ChatBoxEventOutput("supportBox:view",{offline:!0})):c.ChatBoxEventOutput("supportBox:view",{offline:!1}),this.markInitMessageAsHidden(),this.scrollToBottom(),[3,3];case 2:this.isOnceFocusedInput=!1,this.isOnceFocusedTextArea=!1,t.markAsClose(),c.ChatBoxEventOutput("supportBox:close"),n.label=3;case 3:return this.redraw(t,e),[2]}}))}))},t.prototype.prepareHtmlTagMessage=function(t){return"string"!=typeof t?t:t=(t=(t=t.replaceAll("<","&lt;")).replaceAll(">","&gt;")).replaceAll("\n","<br />")},t.prototype.prepareHtmlTagViewMessage=function(t){return"string"!=typeof t?t:t=(t=(t=t.replaceAll("&amp;lt;","&lt;")).replaceAll("&amp;gt;","&gt;")).replaceAll("&lt;br /&gt;","<br />")},t.prototype.initHandleOnClickButtonForOffline=function(t,e){var n=this,r="#supportBoxWebChatOffline";this.getIframeDocument().querySelector(r+' input[type="submit"]').onclick=function(){n.buildChatVariables(r)&&n.handleOnClickButtonForOffline(r,t,e)}},t.prototype.handleOnClickButtonForOffline=function(t,e,n){var i;return r(this,void 0,void 0,(function(){var r,s,a,u,l,c,h,p;return o(this,(function(o){switch(o.label){case 0:return r="customer-offline",s=this.getIframeDocument().querySelector(t+" textarea"),[4,this.resolveUserInfo(!1)];case 1:return o.sent()?(a=s.value,u=this._user.getUserUuid(),l=this._dateTime.getCurrentTimestamp(),c=JSON.stringify({box:e.id,secret:e.secret,type:r,name:this.getSupportBoxChatVariable("fullName"),phone:null!==(i=this.getSupportBoxChatVariable("phone"))&&void 0!==i?i:"",email:this.getSupportBoxChatVariable("email"),message:a,uuid:u,clientIp:n.ipAddress,time:l,userAgent:navigator.userAgent}),h=a.replace(/\n/g,"<br />"),p=this.createMessageFromClient(h),this.sendInitialData(e,c,p),this.watchWritingOperatorForAskUserInfo(),this.processMessage(e,n,p),this._messageRepository.setWaitResponseMessage(),s.value="",this.runTextAreaResize(),this._chatBoxStatePersister.saveText(""),this._chatBoxAttachment.resetAttachments(this.getIframeDocument()),[2]):[2,!1]}}))}))},t.prototype.createMessageFromClient=function(t){return new l.Message(null,null,l.Message.TYPE_FROM_CLIENT,t,this._dateTime.getCurrentTime(),this._dateTime.getCurrentTimestamp(),this._chatBoxAttachment.getAttachments(),null,null,null,null,null,null,null,null,null,null,!1)},t.prototype.watchWritingOperatorForAskUserInfo=function(){var t=this;if(!this.areChatVariablesEnsured()){var e=this,n=function(){return r(t,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return window.removeEventListener("supportBox:operator:writing:stop",n),e._messageRepository.findLast().type===l.Message.TYPE_CHATBOT?[3,2]:[4,e.resolveUserInfoWithInit()];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))};window.addEventListener("supportBox:operator:writing:stop",n)}},t.prototype.sendInitialData=function(t,e,n){var r=t.wasInitTicketData();this.initSockets();var o=this,i=function(){new Promise((function(t){return t()})).then((function(){o._chatBoxGetter.chatBoxSettings.triggers.sendNewTriggers()})).then((function(){o._conn.send(e)})).then((function(){setTimeout((function(){o.sendVariablesFromWelcomeWindow(t,r),o._lastVisitUrlSender.sendLastVisitUrl(t,o._user.getUserUuid())}),100)}))};if(this._conn.readyState===WebSocket.OPEN)i();else{var s=function(){o._conn.removeEventListener("error",a),o._conn.removeEventListener("open",u)},a=function(){o._messageOutgoingQueue.insertMessage(n),s()},u=function(){i(),s()};o._conn.addEventListener("error",a),o._conn.addEventListener("open",u)}t.markInitTicketData()},t.prototype.initMenuTranscriptionSend=function(){var t=this;if(this._chatBoxGetter.chatBoxSettings.allowChatTranscription){var e=this.getIframeDocument().getElementById("menuBox"),n=e.querySelector(".menu-item_email button"),r=e.querySelector('.menu-item_email input[type="email"]');null==r||r.addEventListener("click",(function(e){var n=t._chatBoxStatePersister.getSenderVariables(t._user.getUserUuid());""===r.value.trim()&&(null==n?void 0:n.email)&&(r.value=n.email)})),null==r||r.addEventListener("keydown",(function(t){"Enter"===t.key&&(t.preventDefault(),n.click())})),null==n||n.addEventListener("click",(function(o){r.value=r.value.trim();var i=0===r.value.length,s=!t._emailValidator.isValid(r.value);if(i||s)t._html.addClass(r,"input--invalid-data"),r.focus();else{t._html.removeClass(r,"input--invalid-data"),t.sendRequestTranscriptionMessage(r.value);var a=t.getIframeDocument().querySelector('#supportBoxWebChatArea textarea[name="message"]');e.focus();var u=r.value;r.disabled=!0,r.value=t._translator.translate("webchatMessageTranscriptSent")+".",n.style.visibility="hidden",setTimeout((function(){t.scrollToBottom(),a.focus(),r.disabled=!1,r.value=u,n.style.visibility="visible"}),1e3)}}))}},t.prototype.sendRequestTranscriptionMessage=function(t){var e=this._chatBoxGetter.chatBox;if(this.initSockets(),this._conn.readyState===WebSocket.OPEN){var n=this._user.getUserUuid(),r=JSON.stringify({box:e.id,secret:e.secret,type:"request-transcription",uuid:n,toEmail:t,clientIp:this._chatBoxGetter.chatBoxSettings.ipAddress});this._conn.send(r),c.ChatBoxEventOutput("supportBox:customer:toEmail")}},t.prototype.sendInfoAboutWriting=function(t){var e=this;if(this.canSetTimeoutForSendingCustomerIsWriting){if(this.canSetTimeoutForSendingCustomerIsWriting=!1,!this._conn)return;if(this._conn.readyState===WebSocket.OPEN){var n=this._user.getUserUuid(),r=JSON.stringify({box:t.id,secret:t.secret,type:"customer-writing",uuid:n,clientIp:this._chatBoxGetter.chatBoxSettings.ipAddress});this._conn.send(r),c.ChatBoxEventOutput("supportBox:customer:writing")}this.timeoutForSendingCustomerIsWriting=setTimeout((function(){clearTimeout(e.timeoutForSendingCustomerIsWriting),e.canSetTimeoutForSendingCustomerIsWriting=!0}),3e3)}},t.prototype.sendInfoAboutStopWriting=function(t){var e;if((null===(e=this._conn)||void 0===e?void 0:e.readyState)===WebSocket.OPEN){var n=this._user.getUserUuid(),r=JSON.stringify({box:t.id,secret:t.secret,type:"customer-stop-writing",uuid:n});clearTimeout(this.timeoutForSendingCustomerIsWriting),this.canSetTimeoutForSendingCustomerIsWriting=!0,this._conn.send(r),c.ChatBoxEventOutput("supportBox:customer:writing:stop")}},t.prototype.initSendInfoAboutRead=function(){var t=this,e=this.getIframeDocument().querySelector("#supportBoxWebChatArea textarea");if(null!==e){var n=null;e.addEventListener("focus",(function(){n=setInterval((function(){t.trySendInfoAboutRead()}),1e3),t.trySendInfoAboutRead()})),e.addEventListener("blur",(function(){clearInterval(n)}))}},t.prototype.isNewUnreadMessage=function(t,e){var n="supportboxChat_readLastTime["+t+"]["+this._chatBoxGetter.chatBox.id+"]";return Number(this._chatBoxStatePersister.getValue(n))!==e.timestamp&&(this._chatBoxStatePersister.saveValue(n,e.timestamp),!0)},t.prototype.sendInfoAboutRead=function(t,e){var n=this._chatBoxGetter.chatBox,r=this._user.getUserUuid(),o=JSON.stringify({box:n.id,secret:n.secret,type:t,uuid:r,timestamp:e.timestamp});this._conn.send(o),c.ChatBoxEventOutput("supportBox:customer:read")},t.prototype.trySendInfoAboutRead=function(){if(this.getIframe()===document.activeElement&&this._conn&&this._conn.readyState===WebSocket.OPEN&&!this._messageOutgoingQueue.findFirstUnsentMessage()){var t=this._messageRepository.findLastMessageFromOperator();t&&this.isNewUnreadMessage("message",t)&&this.sendInfoAboutRead("customer-read-message",t),this.trySendInfoMessageType("trigger",this._messageRepository.findLastMessageTrigger()),this.trySendInfoMessageType("chatbot",this._messageRepository.findLastMessageChatBot())}},t.prototype.trySendInfoMessageType=function(t,e){var n=this._messageRepository.findLastMessageFromClient();n&&e&&this.isNewUnreadMessage(t,e)&&(e.timestamp<n.timestamp?this.sendInfoAboutRead("customer-read-"+t,n):this.sendInfoAboutRead("customer-read-"+t,e))},t.prototype.initHandleOnClickCloseInitMessage=function(){var t=this,e=this.getIframeDocument().querySelector(".init-button__init-message-close-button");null!==e&&(e.onclick=function(e){e.stopPropagation(),t.markInitMessageAsHidden(),t.refreshIframeSize()})},t.prototype.markInitMessageAsHidden=function(){var t=this._chatBoxGetter.chatBox,e=this._chatBoxGetter.chatBoxSettings;this._chatBoxStatePersister.markInitMessageAsHidden(),t.markInitMessageAsHidden(),this.redraw(t,e)},t.prototype.initHandleOnClickButtonForWelcomeAndOpen=function(t,e){var n,r,o=this,s=function(n){a.getIframeDocument().querySelector(n+' input[type="submit"]').onclick=function(){if(!o._statusDetector.isStatusOffline()||o._messageRepository.hasMessageFromPeople()){var r=o._chatBoxGetter.chatBoxSettings.behaviour.askUserInfoOnline;"#supportBoxWebChatWelcome"===n&&r&&!o.buildChatVariables(n)||o.handleOnClickButtonOnline(n,t,e)}else o.handleOnClickButtonForOffline(n,t,e)}},a=this;try{for(var u=i(["#supportBoxWebChatOpened","#supportBoxWebChatWelcome","#supportBoxWebChatDirectMessage"]),l=u.next();!l.done;l=u.next())s(l.value)}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}},t.prototype.handleOnClickButtonOnline=function(t,e,n){return r(this,void 0,void 0,(function(){var r,i,s,a,u,l,c;return o(this,(function(o){switch(o.label){case 0:return r="message-in",i=this.getIframeDocument().querySelector(t+" textarea"),[4,this.resolveUserInfo(!1)];case 1:return o.sent()?0!==(s=i.value).length||this._chatBoxAttachment.getAttachments().length?(a=this._user.getUserUuid(),u=this._dateTime.getCurrentTimestamp(),l=JSON.stringify({box:e.id,secret:e.secret,type:r,message:this.prepareHtmlTagMessage(s),uuid:a,clientIp:n.ipAddress,time:u,userAgent:navigator.userAgent}),c=this.createMessageFromClient(s),this.sendInitialData(e,l,c),this.watchWritingOperatorForAskUserInfo(),this.processMessage(e,n,c),i.value="",this.runTextAreaResize(),this.removeChatBotButtonBasedInitMessages(),this._chatBoxStatePersister.saveText(""),this._chatBoxAttachment.resetAttachments(this.getIframeDocument()),[2]):[2]:[2,!1]}}))}))},t.prototype.queryInput=function(t,e){return this.getIframeDocument().querySelector(t+' input[name="'+e+'"]')},t.prototype.trimAndValidateInput=function(t,e){t.value=t.value.trim();var n=e&&0===t.value.length;return n&&this.addInvalidDataClassToInput(t),n},t.prototype.addInvalidDataClassToInput=function(t){this._html.addClass(t,"supportBoxWebChat-window__input--invalid-data")},t.prototype.removeInvalidDataClassToInput=function(t){this._html.removeClass(t,"supportBoxWebChat-window__input--invalid-data")},t.prototype.setSupportBoxChatVariable=function(t,e){"undefined"==typeof supportBoxChatVariables&&(window.supportBoxChatVariables={});try{e&&(supportBoxChatVariables[t]=e)}catch(t){}},t.prototype.getSupportBoxChatVariable=function(t){return"undefined"==typeof supportBoxChatVariables?"":supportBoxChatVariables[t]},t.prototype.isChatVariable=function(t){return!!this.getSupportBoxChatVariable(t)},t.prototype.getChatVariables=function(){return{email:this.getSupportBoxChatVariable("email"),fullName:this.getSupportBoxChatVariable("fullName"),phone:this.getSupportBoxChatVariable("phone")}},t.prototype.areChatVariablesEnsured=function(){return!this._chatBoxGetter.chatBoxSettings.behaviour.askUserInfoByChatbot||!!this.getSupportBoxChatVariable("email")&&!!this.getSupportBoxChatVariable("fullName")},t.prototype.resetChatVariables=function(){if("undefined"==typeof supportBoxChatVariables)return null;"client@email.tld"===supportBoxChatVariables.email&&"John Doe"===supportBoxChatVariables.fullName&&"123456789"===supportBoxChatVariables.phone&&12345===supportBoxChatVariables.customerId&&(supportBoxChatVariables.email="",supportBoxChatVariables.fullName="",supportBoxChatVariables.phone="",supportBoxChatVariables.customerId=0)},t.prototype.buildChatVariables=function(t){var e,n,r=this.queryInput(t,"name"),o=this.queryInput(t,"email"),s=this.queryInput(t,"phone"),a=[r,o,s];try{for(var u=i(a),l=u.next();!l.done;l=u.next()){var c=l.value;this.removeInvalidDataClassToInput(c)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}var h=!this._emailValidator.isValid(o.value);h&&this.addInvalidDataClassToInput(o);var p=this.trimAndValidateInput(o,!0),d=this.trimAndValidateInput(r,!0),f=this.trimAndValidateInput(s,this._chatBoxGetter.chatBoxSettings.offline.requiredPhone);return!(h||p||d||f||(this.resetChatVariables(),this.setSupportBoxChatVariable("email",o.value),this.setSupportBoxChatVariable("fullName",r.value),this.setSupportBoxChatVariable("phone",s.value),0))},t.prototype.sendVariablesFromWelcomeWindow=function(t,e){this._variableSender.sendVariablesWithSocket(e,this._conn,t,this._user.getUserUuid())},t.prototype.processMessage=function(t,e,n){var r=!this._messageRepository.hasMessages()&&t.isStatusOpen;(t.isStatusWelcome||r)&&(this._messageRepository.add(n),this._statusDetector.isStatusOperatorOffline()&&this._statusDetector.isAskUserBeforeMessage()&&this.renderMessage(n,e)),t.addMessageNumber(),t.openSomeWindowAndSetStatus(this._statusDetector.isStatusOffline(),e,this._messageRepository.hasMessageFromClient(),this.hasSenderVariables()),this.redraw(t,e),this.isStatusAndAskUserInfoAfterMessage()?setTimeout((function(){c.ChatBoxEventOutput("supportBox:message:send")}),this.DELAY_FOR_CORRECT_ORDER_MESSAGES):c.ChatBoxEventOutput("supportBox:message:send")},t.prototype.initHandlePressCtrlEnter=function(){var t,e,n=function(t){var e,n,o=[r.getIframeDocument().querySelector(t+" textarea"),r.getIframeDocument().querySelector(t+' input[name="name"]'),r.getIframeDocument().querySelector(t+' input[name="email"]'),r.getIframeDocument().querySelector(t+' input[name="phone"]'),r.getIframeDocument().querySelector(t+" textarea")],s=r.getIframeDocument().querySelector(t+' input[type="submit"]');try{for(var a=(e=void 0,i(o)),u=a.next();!u.done;u=a.next()){var l=u.value;null!==l&&(l.onkeydown=function(t){t.ctrlKey&&"Enter"===t.key&&(s.click(),t.preventDefault())})}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},r=this;try{for(var o=i(["#supportBoxWebChatOpened","#supportBoxWebChatWelcome","#supportBoxWebChatOffline","#supportBoxWebChatDirectMessage"]),s=o.next();!s.done;s=o.next())n(s.value)}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},t.prototype.initTextAreaResize=function(t){var e,n,r=this,o=function(t){var e=s.getIframeDocument().querySelector(t+" textarea");e.onkeyup=function(){r.textAreaResize(e),r.scrollToBottom(),r._chatBoxStatePersister.saveText(e.value),"#supportBoxWebChatOpened"===t&&r.trySendInfoWriting(e)}},s=this;try{for(var a=i(["#supportBoxWebChatOpened","#supportBoxWebChatWelcome","#supportBoxWebChatDirectMessage"]),u=a.next();!u.done;u=a.next())o(u.value)}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},t.prototype.runTextAreaResize=function(){var t=this.getIframeDocument().querySelector("#supportBoxWebChatOpened textarea");t&&this.textAreaResize(t)},t.prototype.textAreaResize=function(t){if(!this._chatBoxGetter.chatBox.isStatusClosed){var e=157,n=58;this._chatBoxGetter.chatBox.isStatusWelcome&&(this._chatBoxGetter.chatBoxSettings.behaviour.askUserInfoOnline||this._statusDetector.isStatusOffline())&&(e=80,n=80),t.style.height="auto";var r=e;if(t.scrollHeight<e){var o=getComputedStyle(t),i=Number(o.borderTopWidth.replace("px",""))+Number(o.borderBottomWidth.replace("px",""));r=t.scrollHeight+i}""===t.value&&(r=n),r<n&&(r=n),t.style.height=r+"px";var s=this.getIframeDocument().getElementById("supportBoxWebChatMessages");if(this._deviceDetector.isMobileDevice())r<65&&(t.style.height="65px"),r+=91,s.style.height="calc(100% - "+r+"px)";else{var a=s.style.height,u=300-r+n;s.style.height=u+"px",a!==s.style.height&&this.refreshIframeSize()}}},t.prototype.trySendInfoWriting=function(t){var e=this._chatBoxGetter.chatBox;""!==t.value?this.sendInfoAboutWriting(e):this.sendInfoAboutStopWriting(e)},t.prototype.initSubmitDisable=function(){var t,e,n=this,r=function(t){var e=o.getIframeDocument().querySelector(t+" textarea"),r=o.getIframeDocument().querySelector(t+' input[type="submit"]'),i=function(){r.disabled=0===e.value.length&&!n._chatBoxAttachment.getAttachments().length};i(),r.addEventListener("click",i,!1),e.addEventListener("input",i,!1)},o=this;try{for(var s=i(["#supportBoxWebChatOpened","#supportBoxWebChatWelcome","#supportBoxWebChatOffline","#supportBoxWebChatDirectMessage"]),a=s.next();!a.done;a=s.next())r(a.value)}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}},t.prototype.isHiddenChat=function(){return!0===this.hiddenChat},t.prototype.changeHiddenChat=function(t){this.hiddenChat=t,t?this.getIframe().style.visibility="hidden":(this.getIframe().style.visibility="",this.refreshIframeSize()),c.ChatBoxEventOutput("supportBox:view:change")},t.prototype.changeStatusIndicator=function(t){void 0===t&&(t=!0);var e=this.getIframeDocument().querySelector(".init-button__operator-status");t?e.classList.remove("hidden"):e.classList.add("hidden")},t.prototype.resolveCustomButtonGraphics=function(t,e,n,r){void 0===r&&(r="");var o=this._chatBoxGetter.chatBoxSettings.color.primary;"bright"===r&&(o=this._chatBoxGetter.chatBoxSettings.color.title);var i=null;return"like"===t&&(i='<path style="fill: '+o+'" d="M346.79,425.66H263.41a13.76,13.76,0,0,0-13.9,13.9V661.92a13.76,13.76,0,0,0,13.9,13.9h83.38a13.76,13.76,0,0,0,13.89-13.9V439.57a13.74,13.74,0,0,0-13.89-13.9Z"/>\n                        <path style="fill: '+o+'" d="M771.73,442.49c0-25.18-16.57-50.67-48.22-50.67H580c20.5-38.25,26.53-92.06,12.28-131.43-10.47-28.95-30.47-45.86-56.35-47.57l-.42,0c-16.84-1.08-31.42,12.09-32.82,29.63-3.69,39-20.09,108.12-43.59,132.65-19.79,20.64-36.72,29.29-64.8,43.62-4.06,2.07-8.5,4.33-13.2,6.78.09,1.06.14,2.12.14,3.2V673.39l10,3.59c46.34,16.66,86.38,31,147.59,31h116c31.65,0,48.21-25.49,48.21-50.67a56.77,56.77,0,0,0-4.32-21.82,45.31,45.31,0,0,0,26.6-15.37c7.76-9.2,12-21.43,12-34.43A56.57,56.57,0,0,0,733.09,564c25.41-4.58,38.64-27.34,38.64-49.84,0-13.05-4.45-26.19-13.15-35.81,8.68-9.63,13.14-22.76,13.14-35.81Z"/>'),"dislike"===t&&(i='<path style="fill: '+o+'" d="M652.21,573.34h83.38a13.76,13.76,0,0,0,13.9-13.9V337.08a13.76,13.76,0,0,0-13.9-13.9H652.21a13.76,13.76,0,0,0-13.89,13.9V559.43a13.74,13.74,0,0,0,13.89,13.9Z"/>\n                <path style="fill: '+o+'" d="M227.27,556.51c0,25.18,16.57,50.67,48.22,50.67H419c-20.5,38.25-26.53,92.06-12.28,131.43,10.47,28.95,30.47,45.86,56.35,47.57l.42,0c16.84,1.08,31.42-12.09,32.82-29.63,3.69-39.05,20.09-108.12,43.59-132.65,19.79-20.64,36.72-29.29,64.8-43.62,4.06-2.07,8.5-4.33,13.2-6.78-.09-1.06-.14-2.12-.14-3.2V325.61l-10-3.59c-46.34-16.66-86.38-31-147.59-31h-116c-31.65,0-48.21,25.49-48.21,50.67a56.77,56.77,0,0,0,4.32,21.82,45.31,45.31,0,0,0-26.6,15.37c-7.76,9.2-12,21.43-12,34.43A56.57,56.57,0,0,0,265.91,435c-25.41,4.58-38.64,27.34-38.64,49.84,0,13.05,4.45,26.19,13.15,35.81-8.68,9.63-13.14,22.76-13.14,35.81Z"/>'),'\n            <svg style="width: '+e+"px; height: "+n+'px" width="25" height="25" viewBox="100 100 800 800">\n                <g>\n                    <g>\n                        '+i+"\n                    </g>\n                </g>\n            </svg>\n            "},t}();e.ChatBoxRenderer=d},1899:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.ReferrerUrlAddress=void 0;var o=function(){function t(){this.type="ReferrerUrlAddress"}return t.prototype.resultRule=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,t.resultByOperator(document.referrer)]}))}))},t}();e.ReferrerUrlAddress=o},93274:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.RuleCustomerInactivity=void 0;var i=function(){function t(){this.type="CustomerInactivity"}return Object.defineProperty(t.prototype,"inactivityListenerEvents",{get:function(){return["DOMContentLoaded","click","touchstart","keydown","keyup","mousemove","mousedown","mouseup","scroll"]},enumerable:!1,configurable:!0}),t.prototype.inactivityAddListener=function(t){var e,n;try{for(var r=o(this.inactivityListenerEvents),i=r.next();!i.done;i=r.next()){var s=i.value;window.addEventListener(s,t,!0)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.inactivityRemoveListener=function(t){var e,n;try{for(var r=o(this.inactivityListenerEvents),i=r.next();!i.done;i=r.next()){var s=i.value;window.removeEventListener(s,t,!0)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.resultRule=function(t){return n(this,void 0,void 0,(function(){var e,o,i,s=this;return r(this,(function(a){switch(a.label){case 0:return o=!1,i=function(){o=!1,clearTimeout(e),e=setTimeout((function(){o=!0}),1e3*Number(t.value))},this.inactivityAddListener(i),i(),[4,n(s,void 0,void 0,(function(){var t=this;return r(this,(function(e){switch(e.label){case 0:return!1!==o?[3,2]:[4,n(t,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,1e3)}))];case 1:return[2,t.sent()]}}))}))];case 1:return e.sent(),[3,0];case 2:return[2]}}))}))];case 1:return a.sent(),this.inactivityRemoveListener(i),[2,!0]}}))}))},t}();e.RuleCustomerInactivity=i},42070:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.RuleMessageReceived=void 0;var o=function(){function t(){this.type="MessageReceived"}return t.prototype.resultRule=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(e=null,t.messageType){case"operator":e=t.messageRepository.findLastMessageFromOperator();break;case"automatic":e=t.messageRepository.findLastMessageTrigger();break;case"chatbot":e=t.messageRepository.findLastMessageChatBot();break;default:e=t.messageRepository.findLastMessageReceived()}return!0===t.value?[2,null!==e]:[2,null===e]}))}))},t}();e.RuleMessageReceived=o},77411:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.RuleMessageSent=void 0;var o=function(){function t(){this.type="MessageSent"}return t.prototype.resultRule=function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){return e=!1,t.messageRepository.findLastMessageFromClient()&&(e=!0),!0===t.value?[2,e]:[2,!e]}))}))},t}();e.RuleMessageSent=o},20570:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.RuleOperatorInactivity=void 0;var i=function(){function t(){this.type="OperatorInactivity",this.times=0,this.runEventOperatorWriting=!1,this.endTriggerEvents=!1}return t.prototype.isLastMessageFromClient=function(t){var e=t.messageRepository.findLastMessageFromOperator();if(null!==e){var n=t.messageRepository.findLastMessageFromClient();return n&&n.timestamp>e.timestamp}return null!==t.messageRepository.findLastMessageFromClient()},t.prototype.initEndTriggerEvents=function(){var t,e,n=this;try{for(var r=o(["supportBox:message:receive","supportBox:message:send"]),i=r.next();!i.done;i=r.next()){var s=i.value;window.addEventListener(s,(function(){n.endTriggerEvents=!0,n.times=0}))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.isEndTriggerEvents=function(){return this.endTriggerEvents},t.prototype.initWritingEvent=function(){var t=this;window.addEventListener("supportBox:operator:writing",(function(){t.runEventOperatorWriting=!0,t.times=0}))},t.prototype.initStopWritingEvent=function(){var t=this;window.addEventListener("supportBox:operator:writing:stop",(function(){t.runEventOperatorWriting=!1}))},t.prototype.isRunEventWriting=function(){return this.runEventOperatorWriting},t.prototype.resultRule=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this.isLastMessageFromClient(t)?(this.initEndTriggerEvents(),this.initWritingEvent(),this.initStopWritingEvent(),[4,this.waitInactivity(t)]):[2,!1];case 1:return e.sent(),this.isEndTriggerEvents()?[2,!1]:[2,this.isLastMessageFromClient(t)]}}))}))},t.prototype.waitInactivity=function(t){return n(this,void 0,void 0,(function(){var e=this;return r(this,(function(o){switch(o.label){case 0:if(!(this.times<=Number(t.value)))return[3,2];if(t.chatBox.hasMessages()&&!this.isRunEventWriting()){if(this.isEndTriggerEvents())return[3,2];this.times++}return[4,n(e,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){return setTimeout(t,1e3)}))];case 1:return[2,t.sent()]}}))}))];case 1:return o.sent(),[3,0];case 2:return[2]}}))}))},t}();e.RuleOperatorInactivity=i},15289:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.RuleOperatorOnline=void 0;var o=function(){function t(){this.type="OperatorOnline"}return t.prototype.resultRule=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,Boolean(t.value)===!t.statusDetector.isStatusOperatorOffline()]}))}))},t}();e.RuleOperatorOnline=o},75511:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.RulePageTitle=void 0;var o=function(){function t(){this.type="PageTitle"}return t.prototype.resultRule=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,t.resultByOperator(document.title)]}))}))},t}();e.RulePageTitle=o},12883:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.RulePagesVisitedCount=void 0;var o=function(){function t(){this.type="PagesVisitedCount"}return t.prototype.resultRule=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,Number(t.value)===Number(t.storage.getItem("pagesVisitedCount"))]}))}))},t}();e.RulePagesVisitedCount=o},23484:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.RuleUrlAddress=void 0;var o=function(){function t(){this.type="UrlAddress"}return t.prototype.resultRule=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return[2,t.resultByOperator(document.location.href)]}))}))},t}();e.RuleUrlAddress=o},56058:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettings=void 0;var n=function(){function t(t,e,n,r,o,i,s,a,u,l,c,h,p,d,f,g,m){this._language=t,this._dictionary=e,this._openedTitle=n,this._areaPlaceholder=r,this._welcomeTitle=o,this._welcomeSubtitle=i,this._welcomeResponseTime=s,this._entryPoint=a,this._offline=u,this._color=l,this._behaviour=c,this._initButton=h,this._chatBotButtonBased=p,this._triggers=d,this._featureToggle=f,this._allowChatTranscription=g,this._ipAddress=m}return Object.defineProperty(t.prototype,"language",{get:function(){return this._language},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dictionary",{get:function(){return this._dictionary},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"openedTitle",{get:function(){return this._openedTitle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"areaPlaceholder",{get:function(){return this._areaPlaceholder},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"welcomeTitle",{get:function(){return this._welcomeTitle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"welcomeSubtitle",{get:function(){return this._welcomeSubtitle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"welcomeResponseTime",{get:function(){return this._welcomeResponseTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"entryPoint",{get:function(){return this._entryPoint},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offline",{get:function(){return this._offline},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"behaviour",{get:function(){return this._behaviour},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initButton",{get:function(){return this._initButton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatBotButtonBased",{get:function(){return this._chatBotButtonBased},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triggers",{get:function(){return this._triggers},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"allowChatTranscription",{get:function(){return this._allowChatTranscription},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ipAddress",{get:function(){return this._ipAddress},enumerable:!1,configurable:!0}),t}();e.ChatBoxSettings=n},97593:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsBehaviour=void 0;var r=n(59860),o=function(){function t(t,e,n,r,o,i,s,a,u,l,c,h,p,d,f,g,m){this._disable=t,this._onlineStatus=e,this._disableOperators=n,this._hideOfflineOperators=r,this._askUserInfoOnline=o,this._askUserInfoOffline=i,this._askUserInfoTitle=s,this._askUserInfoText=a,this._askUserInfoByChatbot=u,this._defaultClientSound=l,this._disableAttachments=c,this._avatarImage=h,this._showAvatarImage=p,this._avatarName=d,this._showAvatarName=f,this._showAvatarInOffline=g,this._showAvatarInTrigger=m}return Object.defineProperty(t.prototype,"isDisable",{get:function(){return this._disable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onlineStatus",{get:function(){return this._onlineStatus},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDisableOperators",{get:function(){return this._disableOperators},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hideOfflineOperators",{get:function(){return this._hideOfflineOperators},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askUserInfoOnline",{get:function(){return this._askUserInfoOnline===r.ChatBoxAskUserInfoEnum.YES_BEFORE_MESSAGE||this._askUserInfoOnline===r.ChatBoxAskUserInfoEnum.YES_AFTER_MESSAGE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askUserInfoOnlineBeforeMessage",{get:function(){return this._askUserInfoOnline===r.ChatBoxAskUserInfoEnum.YES_BEFORE_MESSAGE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askUserInfoOnlineAfterMessage",{get:function(){return this._askUserInfoOnline===r.ChatBoxAskUserInfoEnum.YES_AFTER_MESSAGE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askUserInfoOffline",{get:function(){return this._askUserInfoOffline===r.ChatBoxAskUserInfoEnum.YES_BEFORE_MESSAGE||this._askUserInfoOffline===r.ChatBoxAskUserInfoEnum.YES_AFTER_MESSAGE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askUserInfoOfflineBeforeMessage",{get:function(){return this._askUserInfoOffline===r.ChatBoxAskUserInfoEnum.YES_BEFORE_MESSAGE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askUserInfoOfflineAfterMessage",{get:function(){return this._askUserInfoOffline===r.ChatBoxAskUserInfoEnum.YES_AFTER_MESSAGE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askUserInfoTitle",{get:function(){return this._askUserInfoTitle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askUserInfoText",{get:function(){return this._askUserInfoText},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askUserInfoByChatbot",{get:function(){return this._askUserInfoByChatbot},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultClientSound",{get:function(){return this._defaultClientSound},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDisableAttachments",{get:function(){return this._disableAttachments},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"avatarImage",{get:function(){return this._avatarImage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShowAvatarImage",{get:function(){return this._showAvatarImage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"avatarName",{get:function(){return this._avatarName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShowAvatarName",{get:function(){return this._showAvatarName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShowAvatarInOffline",{get:function(){return this._showAvatarInOffline},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShowAvatarInTrigger",{get:function(){return this._showAvatarInTrigger},enumerable:!1,configurable:!0}),t}();e.ChatBoxSettingsBehaviour=o},93214:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsChatBotButtonBased=void 0;var n=function(){function t(t,e,n,r,o,i,s,a){this.DEVICE_MODE_COMPUTER="computer",this.DEVICE_MODE_PHONE="phone",this.DEVICE_MODE_ALL="all",this.MODE_ALWAYS="always",this.MODE_OPERATORS_ONLINE="operators-online",this.MODE_OPERATORS_OFFLINE="operators-offline",this._id=t,this._buttons=e,this._contents=n,this._mode=r,this._deviceMode=o,this._rules=i,this._askAnotherQuestion=s,this._textRunAgain=a}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttons",{get:function(){return this._buttons},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contents",{get:function(){return this._contents},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){return this._mode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forModeOperatorsOnline",{get:function(){return this._mode===this.MODE_OPERATORS_ONLINE||this._mode===this.MODE_ALWAYS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forModeOperatorsOffline",{get:function(){return this._mode===this.MODE_OPERATORS_OFFLINE||this._mode===this.MODE_ALWAYS},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceMode",{get:function(){return this._deviceMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forDeviceMobile",{get:function(){return this._deviceMode===this.DEVICE_MODE_PHONE||this._deviceMode===this.DEVICE_MODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forDeviceDesktop",{get:function(){return this._deviceMode===this.DEVICE_MODE_COMPUTER||this._deviceMode===this.DEVICE_MODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rules",{get:function(){return this._rules},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRules",{get:function(){return this._rules.hasRules()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"askAnotherQuestion",{get:function(){return this._askAnotherQuestion},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textRunAgain",{get:function(){return this._textRunAgain},enumerable:!1,configurable:!0}),t.prototype.shouldDisplayButtons=function(t,e){var n=this;return!(!(e.isMobileDevice()?n.forDeviceMobile:n.forDeviceDesktop)||!(t.isStatusOperatorOffline()?n.forModeOperatorsOffline:n.forModeOperatorsOnline))&&(!this.hasRules||this._rules.shouldDisplayButtons())},t}();e.ChatBoxSettingsChatBotButtonBased=n},95766:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsChatBotButtonBasedButton=void 0;var n=function(){function t(t,e,n,r){this._id=t,this._type=e,this._title=n,this._url=r}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this._title},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{id:this._id,type:this._type,title:this._title,url:this._url}},t}();e.ChatBoxSettingsChatBotButtonBasedButton=n},83133:(t,e)=>{var n;Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsChatBotButtonBasedButtonType=void 0,(n=e.ChatBoxSettingsChatBotButtonBasedButtonType||(e.ChatBoxSettingsChatBotButtonBasedButtonType={})).Message="message",n.Link="link",n.Start="start",n.Operator="operator"},69052:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsChatBotButtonBasedButtons=void 0;var r=n(95766),o=function(){function t(t){var e=this;this._buttons=[],t.forEach((function(t){e._buttons.push(new r.ChatBoxSettingsChatBotButtonBasedButton(t.id,t.type,t.title,t.url))}))}return Object.defineProperty(t.prototype,"buttons",{get:function(){return this._buttons},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){var t=this._buttons.map((function(t){return t.toJSON()}));return JSON.stringify(t)},t}();e.ChatBoxSettingsChatBotButtonBasedButtons=o},18781:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsChatBotButtonBasedContent=void 0;var n=function(){function t(t){this._text=t}return Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!1,configurable:!0}),t}();e.ChatBoxSettingsChatBotButtonBasedContent=n},23396:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsChatBotButtonBasedContents=void 0;var r=n(18781),o=function(){function t(t){var e=this;this._contents=[],t.forEach((function(t){e._contents.push(new r.ChatBoxSettingsChatBotButtonBasedContent(t.text))}))}return Object.defineProperty(t.prototype,"contents",{get:function(){return this._contents},enumerable:!1,configurable:!0}),t.prototype.hasContents=function(){return this._contents.length>0},t}();e.ChatBoxSettingsChatBotButtonBasedContents=o},31605:function(t,e,n){var r=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsChatBotButtonBasedItems=void 0;var o=n(93214),i=n(69052),s=n(23396),a=n(94855),u=function(){function t(t,e,n){var r=this;this.initDisplayButtonsCalled=!1,this.chatBotButtonBasedActive=null,this.switchedToOperator=!1,this._chatBotButtonBased=[],this._statusDetector=e,this._deviceDetector=n,t.forEach((function(t){r._chatBotButtonBased.push(new o.ChatBoxSettingsChatBotButtonBased(t.id,new i.ChatBoxSettingsChatBotButtonBasedButtons(t.buttons),new s.ChatBoxSettingsChatBotButtonBasedContents(t.contents),t.mode,t.deviceMode,new a.ChatBoxSettingsChatBotButtonBasedRules(t.rules),t.askAnotherQuestion,t.textRunAgain))}))}return t.prototype.trySetDisplayButtons=function(){var t,e;this.initDisplayButtonsCalled=!0;try{for(var n=r(this._chatBotButtonBased),o=n.next();!o.done;o=n.next()){var i=o.value;if(i.shouldDisplayButtons(this._statusDetector,this._deviceDetector))return this.chatBotButtonBasedActive=i,i}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},t.prototype.isInitDisplayButtonsCalled=function(){return this.initDisplayButtonsCalled},t.prototype.getDisplayButtons=function(){return this.chatBotButtonBasedActive},t.prototype.isChatBotButtonBasedActive=function(){return!!this.chatBotButtonBasedActive},t.prototype.switchToOperator=function(){this.switchedToOperator=!0},t.prototype.isSwitchedToOperator=function(){return this.switchedToOperator},t}();e.ChatBoxSettingsChatBotButtonBasedItems=u},61261:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsChatBotButtonBasedRule=void 0;var n=function(){function t(t,e,n,r){this.OPERATOR_IS="is",this.OPERATOR_NOT="not",this.OPERATOR_LIKE="like",this.OPERATOR_NOT_LIKE="not_like",this._id=t,this._operator=e,this._title=n,this._url=r}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"operator",{get:function(){return this._operator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this._title},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),t.prototype.isSatisfied=function(){var t=this.getCompareValue();if(!t)return!1;var e=this._title||this._url;if(!e)return!1;var n=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");switch(this._operator){case this.OPERATOR_IS:return new RegExp("^"+n+"$").test(t);case this.OPERATOR_NOT:return new RegExp("^(?!"+n+"$).*").test(t);case this.OPERATOR_LIKE:return new RegExp(""+n).test(t);case this.OPERATOR_NOT_LIKE:return new RegExp("^(?!.*"+n+").*$").test(t);default:return!1}},t.prototype.getCompareValue=function(){return this._title?document.title:this._url?window.location.href:""},t}();e.ChatBoxSettingsChatBotButtonBasedRule=n},94855:function(t,e,n){var r=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsChatBotButtonBasedRules=void 0;var o=n(61261),i=function(){function t(t){var e=this;this._rules=[],null==t||t.forEach((function(t){e._rules.push(new o.ChatBoxSettingsChatBotButtonBasedRule(t.id,t.operator,t.title,t.url))}))}return Object.defineProperty(t.prototype,"rules",{get:function(){return this._rules},enumerable:!1,configurable:!0}),t.prototype.hasRules=function(){return this._rules.length>0},t.prototype.shouldDisplayButtons=function(){var t,e;try{for(var n=r(this._rules),o=n.next();!o.done;o=n.next())if(!o.value.isSatisfied())return!1}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return!0},t}();e.ChatBoxSettingsChatBotButtonBasedRules=i},59691:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsColor=void 0;var n=function(){function t(t,e){this._primary=t,this._title=e}return Object.defineProperty(t.prototype,"primary",{get:function(){return this._primary},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){return this._title},enumerable:!1,configurable:!0}),t}();e.ChatBoxSettingsColor=n},1327:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsFetcher=void 0;var i=n(56058),s=n(51357),a=n(59691),u=n(97593),l=n(6090),c=n(42323),h=n(31605),p=function(){function t(t,e){this._statusDetector=t,this._deviceDetector=e}return t.prototype.fetchSettings=function(t){return r(this,void 0,Promise,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return e=t.applicationPoint+"/web-chat-api/settings/text/"+t.id+"/"+t.secret,[4,fetch(e)];case 1:return[4,r.sent().json()];case 2:return n=r.sent(),[2,new i.ChatBoxSettings(n.language,n.dictionary,n.openedTitle,n.areaPlaceholder,n.welcomeTitle,n.welcomeSubtitle,n.welcomeResponseTime,n.entryPoint,new s.ChatBoxSettingsOffline(n.offline.title,n.offline.subtitle,n.offline.responseTime,n.offline.placeholderEmail,n.offline.placeholderPhone,n.offline.placeholderName,n.offline.placeholderMessage,n.offline.requiredPhone),new a.ChatBoxSettingsColor(n.color.primary,n.color.title),new u.ChatBoxSettingsBehaviour(n.behaviour.disable,n.behaviour.onlineStatus,n.behaviour.disableOperators,n.behaviour.hideOfflineOperators,n.behaviour.askUserInfoOnline,n.behaviour.askUserInfoOffline,n.behaviour.askUserInfoTitle,n.behaviour.askUserInfoText,n.behaviour.askUserInfoByChatbot,n.behaviour.defaultClientSound,n.behaviour.disableAttachments,n.behaviour.avatarImage,n.behaviour.showAvatarImage,n.behaviour.avatarName,n.behaviour.showAvatarName,n.behaviour.showAvatarInOffline,n.behaviour.showAvatarInTrigger),new l.ChatBoxSettingsInitButton(n.initButton.showStatus,n.initButton.showButtonText,n.initButton.buttonTextOnline,n.initButton.buttonTextOffline,n.initButton.showInitMessage,n.initButton.initMessage,n.initButton.positionArea,n.initButton.hidePromo,n.initButton.expireDays),new h.ChatBoxSettingsChatBotButtonBasedItems(n.chatBotButtonBased,this._statusDetector,this._deviceDetector),new c.ChatBoxSettingsTriggers(n.triggers),n.featureToggle,n.allowChatTranscription,n.ipAddress)]}}))}))},t}();e.ChatBoxSettingsFetcher=p},6090:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsInitButton=void 0;var n=function(){function t(t,e,n,r,o,i,s,a,u){this._showStatus=t,this._showButtonText=e,this._buttonTextOnline=n,this._buttonTextOffline=r,this._showInitMessage=o,this._initMessage=i,this._positionArea=s,this._hidePromo=a,this._expireDays=u}return t.prototype.showStatus=function(t){return 1===this._showStatus||!t&&2===this._showStatus},t.prototype.showButtonText=function(t){return 1===this._showButtonText||!t&&2===this._showButtonText},Object.defineProperty(t.prototype,"buttonTextOnline",{get:function(){return this._buttonTextOnline},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonTextOffline",{get:function(){return this._buttonTextOffline},enumerable:!1,configurable:!0}),t.prototype.showInitMessage=function(t){return 1===this._showInitMessage||!t&&2===this._showInitMessage},Object.defineProperty(t.prototype,"initMessage",{get:function(){return this._initMessage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"positionArea",{get:function(){return 1===this._positionArea?"left":"right"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hidePromo",{get:function(){return this._hidePromo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"expireDays",{get:function(){return this._expireDays},enumerable:!1,configurable:!0}),t}();e.ChatBoxSettingsInitButton=n},51357:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsOffline=void 0;var n=function(){function t(t,e,n,r,o,i,s,a){this._title=t,this._subtitle=e,this._responseTime=n,this._placeholderEmail=r,this._placeholderPhone=o,this._placeholderName=i,this._placeholderMessage=s,this._requiredPhone=a}return Object.defineProperty(t.prototype,"title",{get:function(){return this._title},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subtitle",{get:function(){return this._subtitle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"responseTime",{get:function(){return this._responseTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholderEmail",{get:function(){return this._placeholderEmail},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholderPhone",{get:function(){return this._placeholderPhone},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholderName",{get:function(){return this._placeholderName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholderMessage",{get:function(){return this._placeholderMessage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"requiredPhone",{get:function(){return this._requiredPhone},enumerable:!1,configurable:!0}),t}();e.ChatBoxSettingsOffline=n},84644:function(t,e,n){var r=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsTriggerRule=void 0;var o=n(19886),i=n(93274),s=n(20570),a=n(42070),u=n(77411),l=n(15289),c=n(12883),h=n(75511),p=n(23484),d=n(1899),f=function(){function t(t,e,n,r,f,g,m){this._type=t,this._value=e,this._operator=n,this._messageType=r,this._chatBox=f,this._messageRepository=g,this._statusDetector=m,this._storage=new o.ChatBoxTriggerStorage(this.chatBox.id),this._triggerServices=[new i.RuleCustomerInactivity,new s.RuleOperatorInactivity,new a.RuleMessageReceived,new u.RuleMessageSent,new l.RuleOperatorOnline,new c.RulePagesVisitedCount,new h.RulePageTitle,new p.RuleUrlAddress,new d.ReferrerUrlAddress]}return t.prototype.result=function(){var t,e;try{for(var n=r(this._triggerServices),o=n.next();!o.done;o=n.next()){var i=o.value;if(i.type===this.type)return i.resultRule(this)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return!1},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"operator",{get:function(){return this._operator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"messageType",{get:function(){return this._messageType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this._storage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatBox",{get:function(){return this._chatBox},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"messageRepository",{get:function(){return this._messageRepository},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"statusDetector",{get:function(){return this._statusDetector},enumerable:!1,configurable:!0}),t.prototype.resultByOperator=function(t){var e=String(t),n=String(this.value);return"is"===this.operator?n===e:"not"===this.operator?n!==e:"like"===this.operator?-1!==e.indexOf(n):"notlike"===this.operator?-1===e.indexOf(n):"regular"===this.operator&&new RegExp(n).test(e)},t}();e.ChatBoxSettingsTriggerRule=f},42323:function(t,e,n){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)},o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},s=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxSettingsTriggers=void 0;var a=n(47767),u=n(34747),l=n(84644),c=n(19886),h=new u.DateTime,p=function(){function t(t){this._triggers=t}return Object.defineProperty(t.prototype,"triggers",{get:function(){return this._triggers},enumerable:!1,configurable:!0}),t.prototype.initRenderer=function(t){this._renderer=t},Object.defineProperty(t.prototype,"renderer",{get:function(){return this._renderer},enumerable:!1,configurable:!0}),t.prototype.initChatBox=function(t){this._chatBox=t},Object.defineProperty(t.prototype,"chatBox",{get:function(){return this._chatBox},enumerable:!1,configurable:!0}),t.prototype.initSettings=function(t){this._settings=t},Object.defineProperty(t.prototype,"settings",{get:function(){return this._settings},enumerable:!1,configurable:!0}),t.prototype.initStorage=function(t){this._storage=new c.ChatBoxTriggerStorage(t)},Object.defineProperty(t.prototype,"storage",{get:function(){return this._storage},enumerable:!1,configurable:!0}),t.prototype.initLocalValues=function(){this.storage.setItem("prevVisitPage",this.storage.getItem("lastVisitPage")),this.storage.setItem("lastVisitPage",h.getCurrentTimestamp()),this.storage.setItem("pagesVisitedCount",Number(this.storage.getItem("pagesVisitedCount"))+1),Number(this.storage.getItem("pagesVisitedCount"))>0&&Number(this.storage.getItem("prevVisitPage"))+43200<Number(this.storage.getItem("lastVisitPage"))?(this.storage.setItem("totalCountVisits",Number(this.storage.getItem("totalCountVisits"))+1),this.storage.setItem("pagesVisitedCount","1"),this.storage.setItem("lastTriggerId",""),this.storage.setItem("readCount","0")):this.storage.setItem("totalCountVisits",1)},t.prototype.init=function(t,e,n){this.initRenderer(t),this.initChatBox(e),this.initSettings(n),this.initStorage(e.id),this.initLocalValues()},t.prototype.tryGetTriggers=function(){var t=this.storage.getObj("triggers");return t||(t={}),t},t.prototype.tryGetTriggersSended=function(){var t=this.storage.getObj("triggersSended");return t||(t={}),t},t.prototype.ifTriggersSended=function(t){var e=this.tryGetTriggersSended();return e&&e[t]},t.prototype.ifTriggersReady=function(t){return!this.tryGetTriggersOrderRun().find((function(e){return t===e}))},t.prototype.tryGetTriggersOrderRun=function(){var t=this.storage.getItem("triggersOrderRun");return t?t.split(",").map(Number):[]},t.prototype.runAfterReceiveMessage=function(t,e){var n,r,o=this;try{for(var i=s(["supportBox:message:receive","supportBox:message:send"]),a=i.next();!a.done;a=i.next()){var u=a.value;window.addEventListener(u,(function(){var n,r;try{for(var i=s(t),a=i.next();!a.done;a=i.next()){var u=a.value;if(!o.renderer._messageRepository.isLastMessageFromPeople()&&!o.renderer._messageRepository.isLastMessageFromChatBot())return;o.ifTriggersReady(u.id)&&o.triggerWithRules(u,e)}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}))}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.initRunRuleOperatorOnline=function(t,e){var n,r,o=this;try{for(var i=s(["supportBox:status:change"]),a=i.next();!a.done;a=i.next()){var u=a.value;window.addEventListener(u,(function(){var n,r,i=function(t){if(o.ifTriggersReady(t.id)&&t.rules.length>0){var n=!1;t.rules.forEach((function(t){"OperatorOnline"===t.type&&(n=!0)})),n&&o.triggerWithRules(t,e)}};try{for(var a=s(t),u=a.next();!u.done;u=a.next())i(u.value)}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}))}}catch(t){n={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.run=function(t,e){var n,r,o,i,a=this.tryGetTriggersOrderRun(),u=function(t){if(!l.ifTriggersSended(t)){var n=e.triggers.triggers.find((function(e){return e.id==t}));if(n){var r=l.buildMessage(n);l.addMessageToChat(r)}}},l=this;try{for(var c=s(a),h=c.next();!h.done;h=c.next())u(h.value)}catch(t){n={error:t}}finally{try{h&&!h.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}var p=[],d=function(e){f.ifTriggersSended(e.id)||a.find((function(t){return t==e.id}))||(e.rules.length>0?(f.triggerWithRules(e,t),p.push(e)):f.sendMessage(e))},f=this;try{for(var g=s(e.triggers.triggers),m=g.next();!m.done;m=g.next())d(m.value)}catch(t){o={error:t}}finally{try{m&&!m.done&&(i=g.return)&&i.call(g)}finally{if(o)throw o.error}}this.runAfterReceiveMessage(p,t),this.initRunRuleOperatorOnline(p,t)},t.prototype.triggerWithRules=function(t,e){var n,r=this,s=function(t){return new l.ChatBoxSettingsTriggerRule(t.type,t.value,t.operator,t.messageType,e,r.renderer._messageRepository,r.renderer._statusDetector).result()};(n=t.rules,o(r,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return t=n.map(s),[4,Promise.all(t)];case 1:return[2,e.sent()]}}))}))).then((function(n){n.every((function(t){return!0===t}))&&r.sendMessage(t,e)}))},t.prototype.buildMessage=function(t){return new a.Message(0,0,a.Message.TYPE_TRIGGER,t.text,h.getCurrentTime(),h.getCurrentTimestamp(),[],t.id,null,null,null,null,null,null,null,null,null,!1)},t.prototype.clientSoundPlay=function(){this.renderer._chatBoxClientSound.init(this._chatBox,this._settings),this.renderer._chatBoxClientSound.play()},t.prototype.sendMessage=function(t,e){var n=this,r=this.buildMessage(t);setTimeout((function(){var s,a=function(t){return new l.ChatBoxSettingsTriggerRule(t.type,t.value,t.operator,t.messageType,e,n.renderer._messageRepository,n.renderer._statusDetector).result()};(s=t.rules,o(n,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return t=s.map(a),[4,Promise.all(t)];case 1:return[2,e.sent()]}}))}))).then((function(e){if(e.every((function(t){return!0===t}))){if(!n.ifTriggersReady(t.id))return;n.storage.setItem("lastTriggerId",t.id),n.addToStorageTriggers(t,r),n.renderer._chatBoxStatePersister.markInitMessageAsHidden("false"),n.clientSoundPlay(),n.addMessageToChat(r),n.renderer.isRealMessageSend()&&n.sendNewTriggers()}}))}),1e3*t.delay)},t.prototype.addMessageToChat=function(t){if(this.renderer._messageRepository.add(t),this.renderer.renderMessage(t,this.settings),this.chatBox.isStatusWelcome||this.chatBox.addMessageNumber(),this.chatBox.addTriggerInChat(),!this.chatBox.isOpenWindow){var e=this.renderer.getIframeDocument().querySelector("#supportBoxWebChatInit .init-button__init-message-text--in");e&&(e.innerHTML=t.message),this.renderer._chatBoxStatePersister.wasInitMessageHidden()||this.chatBox.addMissingMessage(),this.renderer.redraw(this.chatBox,this.settings),this.renderer.refreshIframeSize(),this.renderer._chatBoxStatePersister.markInitMessageAsHidden()}},t.prototype.addToStorageTriggers=function(e,n){var r=this.tryGetTriggers();r=t.addToObjectKeyValue(r,e.id,n),this.storage.setObj("triggers",r);var o=this.tryGetTriggersOrderRun();o.push(e.id),this.storage.setItem("triggersOrderRun",o)},t.prototype.sendNewTriggers=function(){var e,n=this;return e=this.tryGetTriggers(),function(r,s){o(this,void 0,void 0,(function(){var s;return i(this,(function(a){switch(a.label){case 0:s=0,a.label=1;case 1:return s<r.length?[4,(u=r[s],o(n,void 0,void 0,(function(){var n,r;return i(this,(function(o){return(n=e[u])&&(n=t.buildTriggerMessage(n),r=this.tryGetTriggersSended(),!n||r&&r[n.triggerId]||(this.renderer._messageOutgoingQueue.insertMessage(n),this.renderer.sendMessageOutgoingQueue(this.chatBox),r=t.addToObjectKeyValue(r,n.triggerId,!0),this.storage.setObj("triggersSended",r))),[2]}))})))]:[3,4];case 2:a.sent(),a.label=3;case 3:return s++,[3,1];case 4:return[2]}var u}))}))}(this.tryGetTriggersOrderRun()),!0},t.buildTriggerMessage=function(t){return new a.Message(t._id,t._operatorId,t._type,t._message,t._time,t._timestamp,t._attachments,t._triggerId,null,null,null,null,null,null,null,null,null,t._isRead)},t.addToObjectKeyValue=function(t,e,n){var o;return r(r({},t),((o={})[e]=n,o))},t.prototype.saveReadCount=function(){var t=Object.keys(this.tryGetTriggers()).length;this.storage.setItem("readCount",t)},t.prototype.getReadCount=function(){return Number(this.storage.getItem("readCount"))},t}();e.ChatBoxSettingsTriggers=p},71613:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxStatePersister=void 0;var r=n(36109),o=n(51491),i=n(92607),s=function(){function t(){this.nameStatus="supportboxChat_status",this.nameText="supportboxChat_text",this.nameAttachments="supportboxChat_attachments",this.initMessageWasHidden="supportboxChat_initMessageWasHidden",this.keyClientSound="supportboxChat_settingsSound",this.keyVariables="supportboxChat_senderVariables",this.keyLastMessageClientTimestamp="supportboxChat_lastMessageClientTimestamp"}return t.prototype.saveStatus=function(t){window.localStorage.setItem(this.nameStatus,t)},t.prototype.saveText=function(t){window.localStorage.setItem(this.nameText,t)},t.prototype.saveAttachments=function(t){window.localStorage.setItem(this.nameAttachments,JSON.stringify(t))},t.prototype.markInitMessageAsHidden=function(t){void 0===t&&(t="true"),window.localStorage.setItem(this.initMessageWasHidden,t)},t.prototype.getStatus=function(){var t=window.localStorage.getItem(this.nameStatus),e=new i.Container;return null===t||e.deviceDetector.isMobileDevice()?r.ChatBox.initialStatus:t},t.prototype.getText=function(){var t=window.localStorage.getItem(this.nameText);return null===t?"":t},t.prototype.getAttachments=function(){var t=window.localStorage.getItem(this.nameAttachments);if(null===t)return[];var e=JSON.parse(t),n=[];return e.forEach((function(t){return n.push(new o.MessageAttachment(t._link,t._name,t._size,t._deleteUrl))})),n},t.prototype.wasInitMessageHidden=function(){return"true"===window.localStorage.getItem(this.initMessageWasHidden)},t.prototype.saveValue=function(t,e){window.localStorage.setItem(t,String(e))},t.prototype.getValue=function(t){return window.localStorage.getItem(t)},t.prototype.removeItem=function(t){window.localStorage.removeItem(t)},t.prototype.saveSenderVariables=function(t,e){e.uuid=t,this.saveValue(this.keyVariables,JSON.stringify(e))},t.prototype.getSenderVariables=function(t){var e=this.getValue(this.keyVariables);if(null===e)return{};var n=JSON.parse(e);if(null==n?void 0:n.uuid){if(n.uuid===t)return n;this.removeItem(this.keyVariables)}return{}},t.prototype.hasSenderVariables=function(t){var e=this.getSenderVariables(t);return!!e.uuid&&!!e.fullName&&!!e.email},t.prototype.saveLastMessageClientTimestamp=function(){this.saveValue(this.keyLastMessageClientTimestamp,Date.now())},t.prototype.getLastMessageClientTimestamp=function(){return Number(this.getValue(this.keyLastMessageClientTimestamp))},t.prototype.hasLastMessageClientTimestamp=function(){return!!this.getLastMessageClientTimestamp()},t}();e.ChatBoxStatePersister=s},19886:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatBoxTriggerStorage=void 0;var n=function(){function t(t){this.prefixKey="supportboxTrigger_",this._localChatBoxId=t}return Object.defineProperty(t.prototype,"localChatBoxId",{get:function(){return this._localChatBoxId},enumerable:!1,configurable:!0}),t.prototype.getKey=function(t){return this.prefixKey+t+"["+this.localChatBoxId+"]"},t.prototype.getItem=function(t){return window.localStorage.getItem(this.getKey(t))},t.prototype.setItem=function(t,e){window.localStorage.setItem(this.getKey(t),e)},t.prototype.getObj=function(t){return JSON.parse(this.getItem(t))},t.prototype.setObj=function(t,e){return this.setItem(t,JSON.stringify(e))},t}();e.ChatBoxTriggerStorage=n},5618:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChatState=void 0;var n=function(){function t(){this._isResolved=!1}return Object.defineProperty(t.prototype,"isResolved",{get:function(){return this._isResolved},set:function(t){this._isResolved=t},enumerable:!1,configurable:!0}),t}();e.ChatState=n},92607:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var r=n(40535),o=n(48259),i=n(61474),s=n(19962),a=n(78552),u=n(1327),l=n(98754),c=n(34747),h=n(46738),p=n(46948),d=n(78725),f=n(62966),g=n(80607),m=n(51466),y=n(71613),b=n(74811),v=n(83005),_=n(45072),B=n(28516),x=n(749),S=n(75139),C=n(5618),w=n(37735),O=n(27270),M=n(12755),T=n(82149),I=n(78120),A=n(59688),E=n(76284),P=function(){function t(){this._variablesSender=new p.VariablesSender,this._html=new r.Html,this._string=new o.StringHelper,this._dateTime=new c.DateTime,this._deviceDetector=new h.DeviceDetector,this._operatorsFetcher=new l.OperatorsFetcher,this._cookie=new i.Cookie,this._messageOutgoingQueue=new f.MessageOutgoingQueue,this._lastVisitUrlSender=new g.LastVisitUrlSender,this._emailValidator=new m.EmailValidator,this._userIdentifierFactory=new s.UserIdentifierFactory(this._cookie,this._string),this._user=new d.User(this._cookie),this._chatBoxStatePersister=new y.ChatBoxStatePersister,this._translator=new b.Translator,this._messageRepository=new B.MessageRepository,this._chatBoxGetter=new x.ChatBoxGetter,this._chatState=new C.ChatState,this._messageFetcher=new w.MessageFetcher(this._messageRepository,this._user,this._chatState),this._statusDetector=new S.StatusDetector(this._chatBoxGetter,this._dateTime,this._messageRepository),this._chatBoxSettingsFetcher=new u.ChatBoxSettingsFetcher(this._statusDetector,this._deviceDetector),this._iframeSizeCalculator=new O.IframeSizeCalculator(this._chatBoxGetter,this._deviceDetector,this._statusDetector),this._chatBoxAttachment=new M.ChatBoxAttachment,this._chatBoxMenu=new T.ChatBoxMenu,this._chatBoxClientSound=new I.ChatBoxClientSound,this._avatar=new A.Avatar(this._chatBoxGetter),this._renderer=new a.ChatBoxRenderer(this._html,this._cookie,this._dateTime,this._deviceDetector,this._user,this._messageOutgoingQueue,this._variablesSender,this._lastVisitUrlSender,this._emailValidator,this._chatBoxStatePersister,this._translator,this._messageRepository,this._statusDetector,this._operatorsFetcher,this._chatBoxGetter,this._chatState,this._iframeSizeCalculator,this._chatBoxAttachment,this._chatBoxMenu,this._chatBoxClientSound,this._avatar),this._chatBoxApiBridge=new E.ChatBoxApiBridge(this._chatBoxGetter,this._renderer,this._statusDetector),this._cronOfflineWindowChecker=new _.CronOfflineWindowChecker(this._chatBoxGetter,this._renderer,this._statusDetector),this._cronManager=new v.CronManager(this._cronOfflineWindowChecker)}return Object.defineProperty(t.prototype,"html",{get:function(){return this._html},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stringHelper",{get:function(){return this._string},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cookie",{get:function(){return this._cookie},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this._renderer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatBoxSettingsFetcher",{get:function(){return this._chatBoxSettingsFetcher},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"operatorsFetcher",{get:function(){return this._operatorsFetcher},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"variablesSender",{get:function(){return this._variablesSender},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"user",{get:function(){return this._user},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userIdentifierFactory",{get:function(){return this._userIdentifierFactory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatBoxStatePersister",{get:function(){return this._chatBoxStatePersister},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"translator",{get:function(){return this._translator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cronManager",{get:function(){return this._cronManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatBoxGetter",{get:function(){return this._chatBoxGetter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceDetector",{get:function(){return this._deviceDetector},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatBoxApiBridge",{get:function(){return this._chatBoxApiBridge},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatState",{get:function(){return this._chatState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"messageFetcher",{get:function(){return this._messageFetcher},enumerable:!1,configurable:!0}),t}();e.Container=P},61474:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Cookie=void 0;var n=function(){function t(){}return t.prototype.getCookieName=function(){return"supportbox_chat_id"},t.prototype.getCookie=function(t){for(var e=t+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return null},t.prototype.setCookie=function(t,e,n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3);var o="; expires="+r.toUTCString();document.cookie=t+"="+(e||"")+o+"; path=/; SameSite=Lax"},t.prototype.deleteCookie=function(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/"},t}();e.Cookie=n},83005:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CronManager=void 0;var n=function(){function t(t){this._offlineWindowChecker=t}return t.prototype.initAllCrons=function(){this._offlineWindowChecker.init()},t}();e.CronManager=n},45072:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CronOfflineWindowChecker=void 0;var n=function(){function t(t,e,n){this._chatBoxGetter=t,this._chatBoxRenderer=e,this._statusDetector=n}return t.prototype.init=function(){var t=this;this.checkAndMaybeSwitchWindow(),setInterval((function(){t.checkAndMaybeSwitchWindow()}),1e3)},t.prototype.checkAndMaybeSwitchWindow=function(){var t=this._statusDetector.isStatusOffline(),e=this._chatBoxGetter.chatBox,n=this._chatBoxGetter.chatBoxSettings;e.isStatusClosed||t&&this._statusDetector.isAskUserBeforeMessageInOffline()&&!e.isStatusWelcome&&!(null==n?void 0:n.chatBotButtonBased.isChatBotButtonBasedActive())&&(e.markAsWelcome(),e.wasInitTicketData()||e.isReadyViewMessageButton(n)||this._chatBoxRenderer.isStatusAndAskUserInfoAfterMessage()||this._chatBoxRenderer.showOfflineWindow(),this._chatBoxRenderer.redrawOperatorStatusInInitButton(),this._chatBoxRenderer.refreshIframeSize())},t}();e.CronOfflineWindowChecker=n},34747:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DateTime=void 0;var n=function(){function t(){}return t.prototype.getCurrentTimestamp=function(){return Math.floor(Date.now()/1e3)},t.prototype.getCurrentTime=function(){var t=new Date,e=t.getHours().toString(),n=t.getMinutes().toString();return 1===e.toString().length&&(e="0"+e),1===n.toString().length&&(n="0"+n),e+":"+n},t}();e.DateTime=n},46738:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DeviceDetector=void 0;var n=function(){function t(){this.maximumMobileWidth=768}return t.prototype.isMobileDevice=function(){return window.innerWidth<=this.maximumMobileWidth},t}();e.DeviceDetector=n},51466:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EmailValidator=void 0;var n=function(){function t(){}return t.prototype.isValid=function(t){return/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,24})+$/.test(t)},t}();e.EmailValidator=n},40535:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Html=void 0;var n=function(){function t(){}return t.prototype.appendHtml=function(t,e){var n=document.createElement("div");for(n.innerHTML=e;n.children.length>0;)t.appendChild(n.children[0])},t.prototype.hasClass=function(t,e){return!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},t.prototype.addClass=function(t,e){this.hasClass(t,e)||(t.className+=" "+e)},t.prototype.removeClass=function(t,e){if(this.hasClass(t,e)){var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(n," ")}},t}();e.Html=n},27270:function(t,e,n){var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,i=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s},o=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.IframeSizeCalculator=void 0;var i=n(46625),s=function(){function t(t,e,n){this.chatBoxGetter=t,this.deviceDetector=e,this.statusDetector=n}return t.prototype.getSizeInPixels=function(t,e){var n=this.chatBoxGetter.chatBox,r=this.chatBoxGetter.chatBoxSettings,o=this.deviceDetector.isMobileDevice(),s=new i.WidthAndHeight(355,660);if(n.isStatusWelcome&&!o&&(null==r?void 0:r.chatBotButtonBased.isChatBotButtonBasedActive())&&(r.behaviour.askUserInfoOnline||this.statusDetector.isStatusOffline())&&(s=new i.WidthAndHeight(355,620)),n.isStatusWelcome&&this.statusDetector.isAskUserBeforeMessageInOffline()&&!o)return s;if(n.isStatusWelcome&&this.statusDetector.isAskUserBeforeMessageInOnline()&&!o)return s;if(n.isReadyViewMessage(r)&&!o)return new i.WidthAndHeight(355,580);if(n.isStatusWelcome&&!o){var a=473,u=t.contentWindow.document.getElementById("supportBoxWebChatWelcome");return u&&!u.classList.contains("hidden")&&(g=u.offsetHeight+109)>a&&(a=g),new i.WidthAndHeight(355,a)}if(!n.isStatusClosed&&o)return new i.WidthAndHeight(document.documentElement.clientWidth,document.documentElement.clientHeight);var l=85,c=(a=100,t.contentWindow.document.querySelector(".init-button__button-text"));if(c&&c.innerHTML&&(l=93+this.getIframeWidthMessage(r,c.innerHTML,10),(f=110+c.offsetWidth)>l&&(l=f)),!n.isOpenWindow&&e){var h=t.contentWindow.document.querySelector("#supportBoxWebChatInit .init-button__init-message-box");if(h&&!h.classList.contains("hidden")){var p=t.contentWindow.document.querySelector("#supportBoxWebChatInit .init-button__init-message-text");if(p){p.style.width="9999px";var d=p.querySelector("#supportBoxWebChatInit .init-button__init-message-text--in");if(d&&""!==d.innerHTML){var f;d.style.whiteSpace="nowrap",d.style.display="inline",(f=53+d.offsetWidth)>l&&(l=f);var g,m=p.querySelector("#supportBoxWebChatInit .init-button__init-message-operator");if(m&&""!==m.innerHTML){var y=125+this.getIframeWidthMessage(r,m.innerText);y>l&&(l=y)}else{var b=50+this.getIframeWidthMessage(r,d.innerHTML);b>l&&(l=b)}(g=(a=178)-19+d.offsetHeight)>a&&(a=g),d.style.whiteSpace="",d.style.display=""}p.style.width=null}}}return new i.WidthAndHeight(l,a)},t.prototype.getIframeWidthMessage=function(t,e,n){void 0===n&&(n=6.5);var i=function(t,e){do{var n=t.pop();e=e.replace(n,t[0])}while(t.length>2);return e.split(t[0])}(["<br />","<br>","\n"],e).map((function(t){return t.length}));return Math.max.apply(Math,o([],r(i)))*n},t.prototype.getIframeWidthForInitMessage=function(t){var e=t.initButton.initMessage.split("<br />").map((function(t){return t.length})),n=50+7*Math.max.apply(Math,o([],r(e))),i=this.getIframeWidthForInitButton(t),s=Math.max(n,i);return Math.min(s,window.innerWidth)},t.prototype.getIframeHeightForInitMessage=function(t){return 160+14*t.initButton.initMessage.split("<br />").length},t.prototype.getIframeWidthForInitButton=function(t){var e=t.initButton.buttonTextOffline;return this.statusDetector.hasSomeOnlineOperator()&&(e=t.initButton.buttonTextOnline),110+10*e.length},t}();e.IframeSizeCalculator=s},80607:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.LastVisitUrlSender=void 0;var n=function(){function t(){}return t.prototype.sendLastVisitUrl=function(t,e){var n=t.applicationPoint+"/api/v0/web-chat/info/last-visit-url/"+t.id+"/"+t.secret+"/"+e;n+="?lastVisitUrl="+encodeURIComponent(window.location.href),n+="&lastVisitTitle="+encodeURIComponent(document.title),fetch(n)},t}();e.LastVisitUrlSender=n},47767:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Message=void 0;var n=function(){function t(t,e,n,r,o,i,s,a,u,l,c,h,p,d,f,g,m,y){this._id=t,this._operatorId=e,this._type=n,this._message=r,this._time=o,this._timestamp=i,this._attachments=s,this._triggerId=a,this._messageChatBotId=u,this._chatBotAnswer=l,this._chatBotAnswerIsPositive=c,this._chatBotQuestionType=h,this._chatBotQuestionChoice=p,this._buttons=d,this._buttonSelected=f,this._buttonId=g,this._buttonChatBot=m,this._isRead=y}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"operatorId",{get:function(){return this._operatorId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"typeModified",{get:function(){return t.TYPE_TRIGGER===this._type||t.TYPE_CHATBOT===this._type||t.TYPE_CHATBOT_REACTION===this._type?t.TYPE_FROM_OPERATOR:this._type},enumerable:!1,configurable:!0}),t.prototype.isTypeAnyChatbot=function(){return[t.TYPE_CHATBOT,t.TYPE_CHATBOT_REACTION,t.TYPE_MESSAGE_BUTTON,t.TYPE_MESSAGE_BUTTON_SELECT,t.TYPE_MESSAGE_BUTTON_NEW].includes(this._type)},Object.defineProperty(t.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timestamp",{get:function(){return this._timestamp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachments",{get:function(){return this._attachments},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triggerId",{get:function(){return this._triggerId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"messageChatBotId",{get:function(){return this._messageChatBotId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatBotAnswer",{get:function(){return this._chatBotAnswer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"chatBotAnswerIsPositive",{get:function(){return this._chatBotAnswerIsPositive},enumerable:!1,configurable:!0}),t.prototype.isChatBotAnswerPositive=function(){return!!this.chatBotAnswerIsPositive},Object.defineProperty(t.prototype,"chatBotQuestionType",{get:function(){return this._chatBotQuestionType},enumerable:!1,configurable:!0}),t.prototype.isChatBotQuestion=function(){return null===this.chatBotAnswer&&this.hasChatBotQuestionChoice()},Object.defineProperty(t.prototype,"chatBotQuestionChoice",{get:function(){return this._chatBotQuestionChoice},enumerable:!1,configurable:!0}),t.prototype.hasChatBotQuestionChoice=function(){return null!==this._chatBotQuestionChoice},Object.defineProperty(t.prototype,"buttons",{get:function(){return this._buttons},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonSelected",{get:function(){return this._buttonSelected},enumerable:!1,configurable:!0}),t.prototype.fakeButtonSelected=function(){this._buttonSelected||(this._buttonSelected="0")},Object.defineProperty(t.prototype,"buttonId",{get:function(){return this._buttonId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buttonChatBot",{get:function(){return this._buttonChatBot},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRead",{get:function(){return this._isRead},enumerable:!1,configurable:!0}),t.TYPE_FROM_CLIENT="message-in",t.TYPE_FROM_OPERATOR="message-out",t.TYPE_TRIGGER="message-trigger",t.TYPE_CHATBOT="message-chatbot",t.TYPE_CHATBOT_REACTION="message-chatbot-reaction",t.TYPE_MESSAGE_BUTTON="message-button",t.TYPE_MESSAGE_BUTTON_NEW="message-button-new",t.TYPE_MESSAGE_BUTTON_SELECT="message-button-select",t.TYPE_TRANSCRIPTION="message-transcription",t}();e.Message=n},51491:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageAttachment=void 0;var n=function(){function t(t,e,n,r){this._link=t,this._name=e,this._size=n,this._deleteUrl=r}return Object.defineProperty(t.prototype,"link",{get:function(){return this._link},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deleteUrl",{get:function(){return this._deleteUrl},enumerable:!1,configurable:!0}),t.TYPE_FROM_OPERATOR="message-out",t}();e.MessageAttachment=n},30428:(t,e)=>{var n;Object.defineProperty(e,"__esModule",{value:!0}),e.MessageChatBotQuestionType=void 0,(n=e.MessageChatBotQuestionType||(e.MessageChatBotQuestionType={})).UNKNOWN="unknown",n.GREETING_MESSAGE="greetingMessage",n.RESULT_QUESTION="resultQuestion",n.HAVE_ANOTHER_QUESTION="haveAnotherQuestion",n.ASK_ANOTHER_QUESTION="askAnotherQuestion",n.THANKS_MESSAGE="thanksMessage",n.OPERATOR_MESSAGE="operatorMessage",n.FOOTER_MESSAGE="footerMessage",n.FOOTER_MESSAGE_LINK="footerMessageLink"},37735:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.MessageFetcher=void 0;var s=n(47767),a=n(42323),u=function(){function t(t,e,n){this._messageRepository=t,this._user=e,this._chatState=n}return t.prototype.fetchMessages=function(t){var e;return r(this,void 0,Promise,(function(){var n,r,i,a=this;return o(this,(function(o){switch(o.label){case 0:return n=this._user.getUserUuid(),r=t.applicationPoint+"/api/v0/web-chat/messages/list/"+t.id+"/"+t.secret+"/"+n,[4,fetch(r)];case 1:return[4,o.sent().json()];case 2:return(null==(i=o.sent())?void 0:i.state)&&(this._chatState.isResolved=null===(e=i.state)||void 0===e?void 0:e.isResolved),i.messages.forEach((function(e){var n=new s.Message(e.id,e.operatorId,e.type,e.text,e.time,e.timestamp,e.attachments,null,null,e.answer,e.answerIsPositive,e.questionType,e.questionChoice,e.buttons,e.buttonSelected,null,null,e.isRead);a._messageRepository.add(n),!n.isRead&&n.operatorId>0&&t.addMissingMessage()})),this.countUnreadTriggers(t),[2]}}))}))},t.prototype.countUnreadTriggers=function(t){var e,n,r=new a.ChatBoxSettingsTriggers;r.initStorage(t.id);var o=r.tryGetTriggersOrderRun();if(o){var s=r.getReadCount();try{for(var u=i(o),l=u.next();!l.done;l=u.next())l.value,s?s--:t.addMissingMessage()}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}}},t}();e.MessageFetcher=u},62966:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageOutgoingQueue=void 0;var n=function(){function t(){this.storageName="message-outgoing-queue"}return t.prototype.findFirstUnsentMessage=function(){var t=window.localStorage,e=t.getItem(this.storageName);if(null===e)return null;var n=JSON.parse(e);if(0===n.length)return null;var r=n.shift();"string"==typeof r&&(r=JSON.parse(r));var o={};return Object.keys(r).forEach((function(t){var e=t.startsWith("_")?t.substring(1):t;o[e]=r[t]})),e=JSON.stringify(n),0===n.length?t.removeItem(this.storageName):t.setItem(this.storageName,e),o},t.prototype.insertMessage=function(t){var e,n=window.localStorage,r=n.getItem(this.storageName);(e=null===r?[]:JSON.parse(r)).push(t),r=JSON.stringify(e),n.setItem(this.storageName,r)},t}();e.MessageOutgoingQueue=n},28516:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageRepository=void 0;var r=n(47767),o=function(){function t(){this.messages=[],this._waitResponseMessage=!1}return t.prototype.hasMessages=function(){return this.messages.length>0||this.waitResponseMessage()},t.prototype.findLast=function(){var t=this.messages.length;return 0===t?null:this.messages[t-1]},t.prototype.isLastMessageFromPeople=function(){var t=this.findLast();return!!t&&(t.type===r.Message.TYPE_FROM_OPERATOR||t.type===r.Message.TYPE_FROM_CLIENT)},t.prototype.isLastMessageFromChatBot=function(){var t=this.findLast();return!!t&&t.type===r.Message.TYPE_CHATBOT},t.prototype.findLastMessageFromPeople=function(){var t=this.messages.length;if(0===t)return null;for(var e=t-1;e>=0;e--)if(this.messages[e].type===r.Message.TYPE_FROM_OPERATOR||this.messages[e].type===r.Message.TYPE_FROM_CLIENT)return this.messages[e];return null},t.prototype.findLastMessageFrom=function(t){var e=this.messages.length;if(0===e)return null;for(var n=e-1;n>=0;n--)if(t.includes(this.messages[n].type))return this.messages[n];return null},t.prototype.findLastMessageReceived=function(){return this.findLastMessageFrom([r.Message.TYPE_TRIGGER,r.Message.TYPE_CHATBOT,r.Message.TYPE_CHATBOT_REACTION,r.Message.TYPE_FROM_OPERATOR])},t.prototype.findLastMessageTrigger=function(){return this.findLastMessageFrom([r.Message.TYPE_TRIGGER])},t.prototype.findLastMessageChatBot=function(){return this.findLastMessageFrom([r.Message.TYPE_CHATBOT])},t.prototype.findLastMessageChatBotReaction=function(){return this.findLastMessageFrom([r.Message.TYPE_CHATBOT_REACTION])},t.prototype.findLastMessageFromOperator=function(){return this.findLastMessageFrom([r.Message.TYPE_FROM_OPERATOR])},t.prototype.findLastMessageFromClient=function(){return this.findLastMessageFrom([r.Message.TYPE_FROM_CLIENT])},t.prototype.hasMessageFromClient=function(){return null!==this.findLastMessageFromClient()},t.prototype.hasMessageFromPeople=function(){return null!==this.findLastMessageFromPeople()},t.prototype.add=function(t){this.messages.push(t)},t.prototype.findAll=function(){return this.sortMessage()},t.prototype.sortMessage=function(){return this.messages.sort((function(t,e){if(t.timestamp!==e.timestamp)return t.timestamp-e.timestamp;if(t.type===e.type)return t.id-e.id;var n=[r.Message.TYPE_TRIGGER,r.Message.TYPE_CHATBOT,r.Message.TYPE_MESSAGE_BUTTON],o=n.indexOf(t.type),i=n.indexOf(e.type);return-1!==o&&-1!==i?o-i:-1!==o?-1:-1!==i?1:0}))},t.prototype.setWaitResponseMessage=function(){this._waitResponseMessage=!0},t.prototype.waitResponseMessage=function(){return this._waitResponseMessage},t}();e.MessageRepository=o},34181:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Operator=void 0;var n=function(){function t(t,e,n,r){this._id=t,this._name=e,this._img=n,this._isOnline=r}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"img",{get:function(){return this._img},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isOnline",{get:function(){return this._isOnline},enumerable:!1,configurable:!0}),t}();e.Operator=n},98754:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.OperatorsFetcher=void 0;var i=n(34181),s=function(){function t(){}return t.prototype.fetchOperators=function(t){return r(this,void 0,Promise,(function(){var e,n,r;return o(this,(function(o){switch(o.label){case 0:return e=t.applicationPoint+"/api/v0/web-chat/operator/list/"+t.id+"/"+t.secret,[4,fetch(e)];case 1:return[4,o.sent().json()];case 2:return n=o.sent(),r=[],n.filter((function(t){return void 0!==t.id})).forEach((function(t){r.push(new i.Operator(t.id,t.name,t.img,t.online))})),[2,r]}}))}))},t}();e.OperatorsFetcher=s},75139:function(t,e){var n=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.StatusDetector=void 0;var r=function(){function t(t,e,n){this._chatBoxGetter=t,this._dateTime=e,this._messageRepository=n}return t.prototype.isStatusOffline=function(){var t=this._chatBoxGetter.chatBox,e=this._chatBoxGetter.chatBoxSettings;if("only-online"===e.behaviour.onlineStatus)return!1;var n=!1;if("only-offline"!==e.behaviour.onlineStatus&&0!==this.getCountOnlineOperators()||(n=!0),"only-offline"!==e.behaviour.onlineStatus&&this.getCountOnlineOperators()>0)return!1;var r=this.hasLastMessageOlderThan15minutes();return n&&(r||!t.wasInitTicketData())},t.prototype.isAskUserBeforeMessageInOffline=function(){var t=this._chatBoxGetter.chatBoxSettings;return this.isStatusOperatorOffline()&&t.behaviour.askUserInfoOfflineBeforeMessage},t.prototype.isAskUserBeforeMessageInOnline=function(){var t=this._chatBoxGetter.chatBoxSettings;return this.isStatusOperatorOnline()&&t.behaviour.askUserInfoOnlineBeforeMessage},t.prototype.isAskUserBeforeMessage=function(){return this.isAskUserBeforeMessageInOnline()||this.isAskUserBeforeMessageInOffline()},t.prototype.isStatusOperatorOnline=function(){return!this.isStatusOperatorOffline()},t.prototype.isStatusOperatorOffline=function(){var t=this._chatBoxGetter.chatBoxSettings;if("only-online"===t.behaviour.onlineStatus)return!1;var e=!1;return"only-offline"!==t.behaviour.onlineStatus&&0!==this.getCountOnlineOperators()||(e=!0),!("only-offline"!==t.behaviour.onlineStatus&&this.getCountOnlineOperators()>0)&&e},t.prototype.hasSomeOnlineOperator=function(){return this.getCountOnlineOperators()>0},t.prototype.getCountOnlineOperators=function(){var t,e,r=0;try{for(var o=n(this._chatBoxGetter.operators),i=o.next();!i.done;i=o.next())i.value.isOnline&&r++}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return r},t.prototype.hasLastMessageOlderThan15minutes=function(){var t=this._messageRepository.findLastMessageFromPeople();return null===t||this._dateTime.getCurrentTimestamp()-900>=t.timestamp},t}();e.StatusDetector=r},48259:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StringHelper=void 0;var n=function(){function t(){}return t.prototype.createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},t}();e.StringHelper=n},74811:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Translator=void 0;var n=function(){function t(){this.language="cs"}return t.prototype.setDictionary=function(t){this.dictionary=t},t.prototype.setLanguage=function(t){this.language=t},t.prototype.translate=function(t){return this.dictionary[t]||"undefined translation"},t}();e.Translator=n},78725:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.User=void 0;var n=function(){function t(t){this._cookie=t}return t.prototype.getUserUuid=function(){return this._cookie.getCookie(this._cookie.getCookieName())},t}();e.User=n},19962:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UserIdentifierFactory=void 0;var n=function(){function t(t,e){this._cookie=t,this._stringHelper=e}return t.prototype.resetData=function(){this._cookie.deleteCookie("supportbox_chat_id"),this._cookie.deleteCookie("supportbox_chat_send_email"),window.localStorage.removeItem("message-outgoing-queue"),Object.keys(window.localStorage).filter((function(t){return t.startsWith("supportboxChat_")||t.startsWith("supportboxTrigger_")})).forEach((function(t){localStorage.removeItem(t)}))},t.prototype.lazyCreate=function(t){var e=this._cookie.getCookieName(),n=this._cookie.getCookie(e),r=t.initButton.expireDays;if(0===r&&(r=3650),null===n){this.resetData();var o=this._stringHelper.createUUID();this._cookie.setCookie(e,o,r)}return this._cookie.getCookie(e)},t}();e.UserIdentifierFactory=n},46948:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VariablesSender=void 0;var r=n(71613),o=function(){function t(){this._chatBoxStatePersister=new r.ChatBoxStatePersister}return t.prototype.sendVariablesWithSocket=function(t,e,n,r){"undefined"!=typeof supportBoxChatVariables&&this.sendCustomVariablesWithSocket(t,e,n,r,supportBoxChatVariables)},t.prototype.sendCustomVariablesWithSocket=function(t,e,n,r,o){if(!(!r||t&&this._chatBoxStatePersister.hasSenderVariables(r))){try{"client@email.tld"===o.email&&"John Doe"===o.fullName&&"123456789"===o.phone&&12345===o.customerId&&(o.email="",o.fullName="",o.phone="",o.customerId=0)}catch(t){}if(o.email&&o.fullName){o.email&&o.fullName&&n.markInitTicketData();var i=JSON.stringify({box:n.id,secret:n.secret,type:"variables",uuid:r,variables:JSON.stringify(o)});e.send(i),this._chatBoxStatePersister.saveSenderVariables(r,o)}}},t}();e.VariablesSender=o},19948:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.WebChatRunner=void 0;var i=n(92607),s=n(36109),a=n(35500),u=function(){function t(){}return t.prototype.run=function(t,e,n,u){return r(this,void 0,void 0,(function(){var r,l,c,h,p,d;return o(this,(function(o){switch(o.label){case 0:return r=new i.Container,l=r.chatBoxStatePersister.getStatus(),c=r.chatBoxStatePersister.wasInitMessageHidden(),h=new s.ChatBox(t,e,n,u,l,c),[4,r.chatBoxSettingsFetcher.fetchSettings(h)];case 1:return(p=o.sent()).behaviour.isDisable?[2]:[4,r.operatorsFetcher.fetchOperators(h)];case 2:return d=o.sent(),[4,r.userIdentifierFactory.lazyCreate(p)];case 3:return o.sent(),[4,r.messageFetcher.fetchMessages(h)];case 4:return o.sent(),r.chatBoxGetter.setState(h,p,d),r.translator.setLanguage(p.language),r.translator.setDictionary(p.dictionary),r.renderer.init(h,p),r.renderer.redraw(h,p),r.cronManager.initAllCrons(),r.chatBoxApiBridge.init(),a.ChatBoxEventOutput("supportBox:create",{chatBoxId:t}),[2]}}))}))},t}();e.WebChatRunner=u},46625:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WidthAndHeight=void 0;var n=function(){function t(t,e){this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),t}();e.WidthAndHeight=n},28032:(t,e,n)=>{(new(n(19948).WebChatRunner)).run(supportBoxChatId,supportBoxChatSecret,supportBoxChatConfig,function(){try{return supportBoxChatRunAsHidden}catch(t){return!1}}())}},e={};!function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}(28032)})();