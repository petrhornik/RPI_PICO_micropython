var FoxentryUserDataHandler=function(){var a=null;function s(e){try{return JSON.parse(e)}catch(e){return!1}return!1}var o=function(e,t,r){var n=new XMLHttpRequest;return n.onreadystatechange=function(){n.readyState==XMLHttpRequest.DONE&&200==n.status&&void 0!==r&&r(n.responseText)},t=JSON.stringify(t),t=encodeURIComponent(t),n.open("POST",FOXENTRY_API_URL+e,!0),n.timeout=5e3,n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("request="+t),n};function e(e){var t,r,n=s(e.data);return!1!==n&&(a=e,"saveActivity"===n.type?o("/data/user/activity/save",{project:(r=n).project,data:{type:r.type,data:r.data,helpers:{host:r.host,project:r.project}},userCode:r.userCode,clientToken:r.clientToken},i):"getUserActivityCode"===n.type?u(e,"userActivityCode",FoxentryUserCode):"suggestUserData"===n.type&&(t=n.data,o("/data/user/suggest",{suggestionTypes:t.suggestionTypes,project:t.project,userCode:FoxentryUserCode},function(e){!1!==(e=s(e))&&u(a,"userDataSuggestion",{callbackType:t.callbackType,data:e})})),!0)}function i(e){e=s(e);if(!1===e)return!1;e.hasOwnProperty("userId")&&(FoxentryUserCode=e.userId,u(a,"userActivityCode",FoxentryUserCode))}function u(e,t,r){"null"!==e&&e.source.postMessage(JSON.stringify({type:t,data:r}),e.origin)}return window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e),{}},FoxentryUserData=FoxentryUserDataHandler();
